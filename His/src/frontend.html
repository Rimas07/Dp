<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HIS - Hospital Information System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
        }

        .header p {
            text-align: center;
            color: #7f8c8d;
        }

        .nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
        }

        .nav-btn.active {
            background: #e74c3c;
            color: white;
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #2c3e50;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #7f8c8d;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online {
            background: #27ae60;
        }

        .status-offline {
            background: #e74c3c;
        }

        .lang-switcher {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .lang-btn {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #3498db;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            color: #3498db;
        }

        .lang-btn:hover {
            background: #3498db;
            color: white;
            transform: translateY(-2px);
        }

        .lang-btn.active {
            background: #3498db;
            color: white;
        }

        .header {
            position: relative;
        }

        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
                align-items: center;
            }

            .nav-btn {
                width: 200px;
            }

            .container {
                padding: 10px;
            }

            .lang-switcher {
                position: static;
                justify-content: center;
                margin-top: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="lang-switcher">
                <button class="lang-btn active" onclick="changeLanguage('ru')" id="lang-ru">üá∑üá∫ RU</button>
                <button class="lang-btn" onclick="changeLanguage('en')" id="lang-en">üá¨üáß EN</button>
            </div>
            <h1 data-i18n="header.title">üè• HIS - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π</h1>
            <p data-i18n="header.subtitle">–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏</p>
        </div>

        <nav class="nav">
            <button class="nav-btn" onclick="showSection('login')" data-i18n="nav.login">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</button>
            <button class="nav-btn" onclick="showSection('tenants')" data-i18n="nav.companies">üè¢ –ö–æ–º–ø–∞–Ω–∏–∏</button>
            <button class="nav-btn" onclick="showSection('patients')" data-i18n="nav.patients">üë• –ü–∞—Ü–∏–µ–Ω—Ç—ã</button>
            <button class="nav-btn" onclick="showSection('limits')" data-i18n="nav.limits">üìä –õ–∏–º–∏—Ç—ã</button>
            <button class="nav-btn" onclick="showSection('audit')" data-i18n="nav.audit">üìã –ê—É–¥–∏—Ç</button>
            <button class="nav-btn" onclick="logout()" style="background: #e74c3c;" data-i18n="nav.logout">üö™
                –í—ã–π—Ç–∏</button>
        </nav>

        <div class="content">
            <!-- –°–µ–∫—Ü–∏—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
            <div id="login" class="section active">
                <h2 data-i18n="login.title">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="email" data-i18n="login.email">Email:</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password" data-i18n="login.password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn btn-success" data-i18n="login.submit">–í–æ–π—Ç–∏</button>
                </form>
                <div id="loginMessage"></div>
                <button onclick="debugToken()" class="btn" style="margin-top: 10px;" data-i18n="login.debug">üîç –û—Ç–ª–∞–¥–∫–∞
                    —Ç–æ–∫–µ–Ω–∞</button>
            </div>

            <!-- –°–µ–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏–∏ -->
            <div id="tenants" class="section">
                <h2 data-i18n="tenants.title">üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏</h2>
                <form id="createCompanyForm">
                    <h3 data-i18n="tenants.createNew">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é</h3>
                    <div class="form-group">
                        <label for="companyName" data-i18n="tenants.companyName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:</label>
                        <input type="text" id="companyName" name="companyName" required>
                    </div>
                    <h4 data-i18n="tenants.adminData">–î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:</h4>
                    <div class="form-group">
                        <label for="adminName" data-i18n="tenants.adminName">–ò–º—è:</label>
                        <input type="text" id="adminName" name="adminName" required>
                    </div>
                    <div class="form-group">
                        <label for="adminEmail" data-i18n="tenants.adminEmail">Email:</label>
                        <input type="email" id="adminEmail" name="adminEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="adminPassword" data-i18n="tenants.adminPassword">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="adminPassword" name="adminPassword" required>
                    </div>
                    <button type="submit" class="btn btn-success" data-i18n="tenants.submit">–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é</button>
                </form>
                <div id="companyMessage"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ -->
            <div id="patients" class="section">
                <h2 data-i18n="patients.title">üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏</h2>
                <div class="form-group">
                    <label for="tenantId" data-i18n="patients.tenantId">ID –¢–µ–Ω–∞–Ω—Ç–∞:</label>
                    <input type="text" id="tenantId" name="tenantId"
                        data-i18n-placeholder="patients.tenantIdPlaceholder" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞">
                </div>
                <button onclick="loadPatients()" class="btn" data-i18n="patients.loadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</button>
                <button onclick="showCreatePatientForm()" class="btn btn-success" data-i18n="patients.addBtn">–î–æ–±–∞–≤–∏—Ç—å
                    –ø–∞—Ü–∏–µ–Ω—Ç–∞</button>

                <div id="createPatientForm" class="hidden">
                    <h3 data-i18n="patients.addNewTitle">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞</h3>
                    <form id="patientForm">
                        <div class="form-group">
                            <label for="patientName" data-i18n="patients.name">–ò–º—è:</label>
                            <input type="text" id="patientName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="patientSurname" data-i18n="patients.surname">–§–∞–º–∏–ª–∏—è:</label>
                            <input type="text" id="patientSurname" name="surname" required>
                        </div>
                        <div class="form-group">
                            <label for="patientAge" data-i18n="patients.age">–í–æ–∑—Ä–∞—Å—Ç:</label>
                            <input type="text" id="patientAge" name="age" required
                                data-i18n-placeholder="patients.agePlaceholder" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 25">
                        </div>
                        <button type="submit" class="btn btn-success" data-i18n="patients.saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            –ø–∞—Ü–∏–µ–Ω—Ç–∞</button>
                        <button type="button" onclick="hideCreatePatientForm()" class="btn btn-danger"
                            data-i18n="patients.cancelBtn">–û—Ç–º–µ–Ω–∞</button>
                    </form>
                </div>

                <div id="patientsList"></div>
                <div id="patientsMessage"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ -->
            <div id="limits" class="section">
                <h2 data-i18n="limits.title">üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏</h2>
                <div class="form-group">
                    <label for="limitsTenantId" data-i18n="limits.tenantId">ID –¢–µ–Ω–∞–Ω—Ç–∞:</label>
                    <input type="text" id="limitsTenantId" name="limitsTenantId"
                        data-i18n-placeholder="limits.tenantIdPlaceholder" placeholder="–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞">
                </div>
                <button onclick="loadLimits()" class="btn" data-i18n="limits.loadBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–∏–º–∏—Ç—ã</button>
                <button onclick="loadUsage()" class="btn" data-i18n="limits.loadUsageBtn">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>

                <div id="limitsContent"></div>
                <div id="limitsMessage"></div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –∞—É–¥–∏—Ç–∞ -->
            <div id="audit" class="section">
                <h2 data-i18n="audit.title">üìã –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞</h2>
                <p data-i18n="audit.description">–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ.</p>
                <button onclick="loadSystemStats()" class="btn" data-i18n="audit.refreshBtn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É</button>
                <button onclick="testPatientsCount()" class="btn" data-i18n="audit.checkPatientsBtn">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
                    –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</button>
                <div class="card">
                    <h3 data-i18n="audit.systemStats">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã</h3>
                    <div class="grid">
                        <div class="card">
                            <h4 data-i18n="audit.totalTenants">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–∞–Ω—Ç–æ–≤</h4>
                            <p id="totalTenants" data-i18n="audit.loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        </div>
                        <div class="card">
                            <h4 data-i18n="audit.totalPatients">–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤</h4>
                            <p id="totalPatients" data-i18n="audit.loading">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        </div>
                        <div class="card">
                            <h4 data-i18n="audit.systemStatus">–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</h4>
                            <p><span class="status-indicator status-online"></span><span
                                    data-i18n="audit.online">–û–Ω–ª–∞–π–Ω</span></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const translations = {
            ru: {
                header: {
                    title: "üè• HIS - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π",
                    subtitle: "–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏"
                },
                nav: {
                    login: "üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è",
                    companies: "üè¢ –ö–æ–º–ø–∞–Ω–∏–∏",
                    patients: "üë• –ü–∞—Ü–∏–µ–Ω—Ç—ã",
                    limits: "üìä –õ–∏–º–∏—Ç—ã",
                    audit: "üìã –ê—É–¥–∏—Ç",
                    logout: "üö™ –í—ã–π—Ç–∏"
                },
                login: {
                    title: "üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è",
                    email: "Email:",
                    password: "–ü–∞—Ä–æ–ª—å:",
                    submit: "–í–æ–π—Ç–∏",
                    debug: "üîç –û—Ç–ª–∞–¥–∫–∞ —Ç–æ–∫–µ–Ω–∞",
                    successMessage: "–£—Å–ø–µ—à–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è! Tenant ID:",
                    errorMessage: "–û—à–∏–±–∫–∞:",
                    alreadyLoggedIn: "–í—ã —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã",
                    needAuth: "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–∏—Å—Ç–µ–º–æ–π"
                },
                tenants: {
                    title: "üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏—è–º–∏",
                    createNew: "–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–æ–º–ø–∞–Ω–∏—é",
                    companyName: "–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏:",
                    adminData: "–î–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:",
                    adminName: "–ò–º—è:",
                    adminEmail: "Email:",
                    adminPassword: "–ü–∞—Ä–æ–ª—å:",
                    submit: "–°–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏—é",
                    successMessage: "–ö–æ–º–ø–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞! ID:",
                    errorMessage: "–û—à–∏–±–∫–∞:"
                },
                patients: {
                    title: "üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏",
                    tenantId: "ID –¢–µ–Ω–∞–Ω—Ç–∞:",
                    tenantIdPlaceholder: "–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞",
                    loadBtn: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
                    addBtn: "–î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                    addNewTitle: "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                    name: "–ò–º—è:",
                    surname: "–§–∞–º–∏–ª–∏—è:",
                    age: "–í–æ–∑—Ä–∞—Å—Ç:",
                    agePlaceholder: "–ù–∞–ø—Ä–∏–º–µ—Ä: 25",
                    saveBtn: "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–∞",
                    cancelBtn: "–û—Ç–º–µ–Ω–∞",
                    successAdd: "–ü–∞—Ü–∏–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!",
                    errorMessage: "–û—à–∏–±–∫–∞:",
                    needTenantId: "–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞",
                    needAuth: "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è",
                    notFound: "–ü–∞—Ü–∏–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
                    tableHeaderName: "–ò–º—è",
                    tableHeaderSurname: "–§–∞–º–∏–ª–∏—è",
                    tableHeaderAge: "–í–æ–∑—Ä–∞—Å—Ç"
                },
                limits: {
                    title: "üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏",
                    tenantId: "ID –¢–µ–Ω–∞–Ω—Ç–∞:",
                    tenantIdPlaceholder: "–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞",
                    loadBtn: "–ó–∞–≥—Ä—É–∑–∏—Ç—å –ª–∏–º–∏—Ç—ã",
                    loadUsageBtn: "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
                    currentLimits: "–¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã",
                    usageStats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è",
                    needTenantId: "–í–≤–µ–¥–∏—Ç–µ ID —Ç–µ–Ω–∞–Ω—Ç–∞",
                    needAuth: "–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è",
                    errorMessage: "–û—à–∏–±–∫–∞:"
                },
                audit: {
                    title: "üìã –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞",
                    description: "–ó–¥–µ—Å—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ.",
                    refreshBtn: "üîÑ –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É",
                    checkPatientsBtn: "üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
                    systemStats: "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã",
                    totalTenants: "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–∞–Ω—Ç–æ–≤",
                    totalPatients: "–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤",
                    systemStatus: "–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã",
                    loading: "–ó–∞–≥—Ä—É–∑–∫–∞...",
                    online: "–û–Ω–ª–∞–π–Ω",
                    offline: "–û—à–∏–±–∫–∞",
                    recentEvents: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è",
                    time: "–í—Ä–µ–º—è",
                    event: "–°–æ–±—ã—Ç–∏–µ",
                    tenant: "–¢–µ–Ω–∞–Ω—Ç",
                    user: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å",
                    noEvents: "–°–æ–±—ã—Ç–∏—è –∞—É–¥–∏—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
                },
                common: {
                    loggedOut: "–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã",
                    connectionError: "–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:",
                    loadingError: "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏"
                }
            },
            en: {
                header: {
                    title: "üè• HIS - Hospital Information System",
                    subtitle: "Comprehensive system for managing medical data and tenants"
                },
                nav: {
                    login: "üîê Login",
                    companies: "üè¢ Companies",
                    patients: "üë• Patients",
                    limits: "üìä Limits",
                    audit: "üìã Audit",
                    logout: "üö™ Logout"
                },
                login: {
                    title: "üîê Login",
                    email: "Email:",
                    password: "Password:",
                    submit: "Sign In",
                    debug: "üîç Debug Token",
                    successMessage: "Successful authentication! Tenant ID:",
                    errorMessage: "Error:",
                    alreadyLoggedIn: "You are already logged in",
                    needAuth: "You need to log in to work with the system"
                },
                tenants: {
                    title: "üè¢ Company Management",
                    createNew: "Create New Company",
                    companyName: "Company Name:",
                    adminData: "Administrator Data:",
                    adminName: "Name:",
                    adminEmail: "Email:",
                    adminPassword: "Password:",
                    submit: "Create Company",
                    successMessage: "Company successfully created! ID:",
                    errorMessage: "Error:"
                },
                patients: {
                    title: "üë• Patient Management",
                    tenantId: "Tenant ID:",
                    tenantIdPlaceholder: "Enter tenant ID",
                    loadBtn: "Load Patients",
                    addBtn: "Add Patient",
                    addNewTitle: "Add New Patient",
                    name: "First Name:",
                    surname: "Last Name:",
                    age: "Age:",
                    agePlaceholder: "Example: 25",
                    saveBtn: "Save Patient",
                    cancelBtn: "Cancel",
                    successAdd: "Patient successfully added!",
                    errorMessage: "Error:",
                    needTenantId: "Enter tenant ID",
                    needAuth: "You need to log in",
                    notFound: "No patients found",
                    tableHeaderName: "First Name",
                    tableHeaderSurname: "Last Name",
                    tableHeaderAge: "Age"
                },
                limits: {
                    title: "üìä Limits Management",
                    tenantId: "Tenant ID:",
                    tenantIdPlaceholder: "Enter tenant ID",
                    loadBtn: "Load Limits",
                    loadUsageBtn: "Load Statistics",
                    currentLimits: "Current Limits",
                    usageStats: "Usage Statistics",
                    needTenantId: "Enter tenant ID",
                    needAuth: "You need to log in",
                    errorMessage: "Error:"
                },
                audit: {
                    title: "üìã Audit Log",
                    description: "This displays the log of all actions in the system.",
                    refreshBtn: "üîÑ Refresh Statistics",
                    checkPatientsBtn: "üîç Check Patients",
                    systemStats: "System Statistics",
                    totalTenants: "Total Tenants",
                    totalPatients: "Total Patients",
                    systemStatus: "System Status",
                    loading: "Loading...",
                    online: "Online",
                    offline: "Error",
                    recentEvents: "Recent Events",
                    time: "Time",
                    event: "Event",
                    tenant: "Tenant",
                    user: "User",
                    noEvents: "No audit events found"
                },
                common: {
                    loggedOut: "You have been logged out",
                    connectionError: "Connection error:",
                    loadingError: "Loading error"
                }
            }
        };

        let currentLanguage = localStorage.getItem('language') || 'ru';

        function applyTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const keys = key.split('.');
                let translation = translations[currentLanguage];

                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }

                if (translation) {
                    element.textContent = translation;
                }
            });

            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const keys = key.split('.');
                let translation = translations[currentLanguage];

                for (const k of keys) {
                    translation = translation[k];
                    if (!translation) break;
                }

                if (translation) {
                    element.placeholder = translation;
                }
            });

            document.documentElement.lang = currentLanguage;
        }

        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('language', lang);

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${lang}`).classList.add('active');

            applyTranslations();
        }
        const API_BASE_URL = 'http://localhost:3000';
        let currentToken = localStorage.getItem('authToken');
        let currentTenantId = localStorage.getItem('currentTenantId');

        document.addEventListener('DOMContentLoaded', function () {
            applyTranslations();

            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`lang-${currentLanguage}`).classList.add('active');

            if (currentToken) {
                showMessage('loginMessage', translations[currentLanguage].login.alreadyLoggedIn, 'success');
                if (currentTenantId) {
                    document.getElementById('tenantId').value = currentTenantId;
                    document.getElementById('limitsTenantId').value = currentTenantId;
                }
            } else {
                showMessage('loginMessage', translations[currentLanguage].login.needAuth, 'error');
            }
            loadSystemStats();
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(sectionId).classList.add('active');

            event.target.classList.add('active');
        }

        function showMessage(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                element.innerHTML = '';
            }, 5000);
        }

        document.getElementById('loginForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok) {
                    currentToken = data.accessToken;
                    currentTenantId = data.tenantId;
                    localStorage.setItem('authToken', currentToken);
                    localStorage.setItem('currentTenantId', currentTenantId);
                    showMessage('loginMessage', `${translations[currentLanguage].login.successMessage} ${currentTenantId}`, 'success');
                    console.log('–¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', currentToken);
                    console.log('Tenant ID —Å–æ—Ö—Ä–∞–Ω–µ–Ω:', currentTenantId);
                } else {
                    showMessage('loginMessage', `${translations[currentLanguage].login.errorMessage} ${data.message || 'Invalid credentials'}`, 'error');
                }
            } catch (error) {
                showMessage('loginMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        });

        document.getElementById('createCompanyForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const companyData = {
                companyName: document.getElementById('companyName').value,
                user: {
                    name: document.getElementById('adminName').value,
                    email: document.getElementById('adminEmail').value,
                    password: document.getElementById('adminPassword').value
                }
            };

            try {
                const response = await fetch(`${API_BASE_URL}/tenants/create-company`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(companyData)
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('companyMessage', `${translations[currentLanguage].tenants.successMessage} ${data.tenantId}`, 'success');
                    document.getElementById('createCompanyForm').reset();
                } else {
                    showMessage('companyMessage', `${translations[currentLanguage].tenants.errorMessage} ${data.message || 'Failed to create company'}`, 'error');
                }
            } catch (error) {
                showMessage('companyMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        });

        function showCreatePatientForm() {
            document.getElementById('createPatientForm').classList.remove('hidden');
        }

        function hideCreatePatientForm() {
            document.getElementById('createPatientForm').classList.add('hidden');
            document.getElementById('patientForm').reset();
        }

        document.getElementById('patientForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const tenantId = document.getElementById('tenantId').value;
            if (!tenantId) {
                showMessage('patientsMessage', translations[currentLanguage].patients.needTenantId, 'error');
                return;
            }

            if (!currentToken) {
                showMessage('patientsMessage', translations[currentLanguage].patients.needAuth, 'error');
                return;
            }

            const patientData = {
                name: document.getElementById('patientName').value,
                surname: document.getElementById('patientSurname').value,
                age: document.getElementById('patientAge').value
            };

            try {
                const response = await fetch(`${API_BASE_URL}/patients`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Tenant-ID': tenantId,
                        'Authorization': `Bearer ${currentToken}`
                    },
                    body: JSON.stringify(patientData)
                });

                const data = await response.json();

                if (response.ok) {
                    showMessage('patientsMessage', translations[currentLanguage].patients.successAdd, 'success');
                    document.getElementById('patientForm').reset();
                    hideCreatePatientForm();
                    loadPatients();
                } else {
                    showMessage('patientsMessage', `${translations[currentLanguage].patients.errorMessage} ${data.message || 'Failed to add patient'}`, 'error');
                }
            } catch (error) {
                showMessage('patientsMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        });

        async function loadPatients() {
            const tenantId = document.getElementById('tenantId').value;
            if (!tenantId) {
                showMessage('patientsMessage', translations[currentLanguage].patients.needTenantId, 'error');
                return;
            }

            if (!currentToken) {
                showMessage('patientsMessage', translations[currentLanguage].patients.needAuth, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/patients`, {
                    headers: {
                        'X-Tenant-ID': tenantId,
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    displayPatients(data);
                } else {
                    showMessage('patientsMessage', `${translations[currentLanguage].patients.errorMessage} ${data.message || 'Failed to load patients'}`, 'error');
                }
            } catch (error) {
                showMessage('patientsMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        }

        function displayPatients(patients) {
            const container = document.getElementById('patientsList');

            if (!patients || patients.length === 0) {
                container.innerHTML = `<p>${translations[currentLanguage].patients.notFound}</p>`;
                return;
            }

            let html = `<table class="table"><thead><tr><th>${translations[currentLanguage].patients.tableHeaderName}</th><th>${translations[currentLanguage].patients.tableHeaderSurname}</th><th>${translations[currentLanguage].patients.tableHeaderAge}</th></tr></thead><tbody>`;

            patients.forEach(patient => {
                html += `
                    <tr>
                        <td>${patient.name || 'N/A'}</td>
                        <td>${patient.surname || 'N/A'}</td>
                        <td>${patient.age || 'N/A'}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        async function loadLimits() {
            const tenantId = document.getElementById('limitsTenantId').value;
            if (!tenantId) {
                showMessage('limitsMessage', translations[currentLanguage].limits.needTenantId, 'error');
                return;
            }

            if (!currentToken) {
                showMessage('limitsMessage', translations[currentLanguage].limits.needAuth, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/limits/${tenantId}`, {
                    headers: {
                        'X-Tenant-ID': tenantId,
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    displayLimits(data);
                } else {
                    showMessage('limitsMessage', `${translations[currentLanguage].limits.errorMessage} ${data.message || 'Failed to load limits'}`, 'error');
                }
            } catch (error) {
                showMessage('limitsMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        }

        async function loadUsage() {
            const tenantId = document.getElementById('limitsTenantId').value;
            if (!tenantId) {
                showMessage('limitsMessage', translations[currentLanguage].limits.needTenantId, 'error');
                return;
            }

            if (!currentToken) {
                showMessage('limitsMessage', translations[currentLanguage].limits.needAuth, 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/limits/usage/${tenantId}`, {
                    headers: {
                        'X-Tenant-ID': tenantId,
                        'Authorization': `Bearer ${currentToken}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();

                if (response.ok) {
                    displayUsage(data);
                } else {
                    showMessage('limitsMessage', `${translations[currentLanguage].limits.errorMessage} ${data.message || 'Failed to load statistics'}`, 'error');
                }
            } catch (error) {
                showMessage('limitsMessage', `${translations[currentLanguage].common.connectionError} ${error.message}`, 'error');
            }
        }

        function displayLimits(limits) {
            const container = document.getElementById('limitsContent');
            container.innerHTML = `
                <h3>${translations[currentLanguage].limits.currentLimits}</h3>
                <div class="card">
                    <pre>${JSON.stringify(limits, null, 2)}</pre>
                </div>
            `;
        }

        function displayUsage(usage) {
            const container = document.getElementById('limitsContent');
            container.innerHTML = `
                <h3>${translations[currentLanguage].limits.usageStats}</h3>
                <div class="card">
                    <pre>${JSON.stringify(usage, null, 2)}</pre>
                </div>
            `;
        }

        async function loadSystemStats() {
            try {
                const response = await fetch(`${API_BASE_URL}/audit/stats`);
                const data = await response.json();

                console.log('üìä –ü–æ–ª—É—á–µ–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:', data);

                if (response.ok) {
                    document.getElementById('totalTenants').textContent = data.totalTenants || 0;
                    document.getElementById('totalPatients').textContent = data.totalPatients || 0;

                    const statusElement = document.querySelector('.status-indicator');
                    if (data.systemStatus === 'online') {
                        statusElement.className = 'status-indicator status-online';
                        statusElement.nextSibling.textContent = translations[currentLanguage].audit.online;
                    } else {
                        statusElement.className = 'status-indicator status-offline';
                        statusElement.nextSibling.textContent = translations[currentLanguage].audit.offline;
                    }

                    displayRecentEvents(data.recentEvents || []);
                } else {
                    document.getElementById('totalTenants').textContent = translations[currentLanguage].common.loadingError;
                    document.getElementById('totalPatients').textContent = translations[currentLanguage].common.loadingError;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
                document.getElementById('totalTenants').textContent = translations[currentLanguage].common.loadingError;
                document.getElementById('totalPatients').textContent = translations[currentLanguage].common.loadingError;
            }
        }

        function displayRecentEvents(events) {
            const auditSection = document.getElementById('audit');
            let eventsHtml = '';

            if (events && events.length > 0) {
                eventsHtml = `
                    <h3>${translations[currentLanguage].audit.recentEvents}</h3>
                    <div class="card">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>${translations[currentLanguage].audit.time}</th>
                                    <th>${translations[currentLanguage].audit.event}</th>
                                    <th>${translations[currentLanguage].audit.tenant}</th>
                                    <th>${translations[currentLanguage].audit.user}</th>
                                </tr>
                            </thead>
                            <tbody>
                `;

                events.forEach(event => {
                    const date = new Date(event.timestamp).toLocaleString(currentLanguage === 'ru' ? 'ru-RU' : 'en-US');
                    eventsHtml += `
                        <tr>
                            <td>${date}</td>
                            <td>${event.eventType || 'Unknown'}</td>
                            <td>${event.tenantId || 'N/A'}</td>
                            <td>${event.userId || 'N/A'}</td>
                        </tr>
                    `;
                });

                eventsHtml += '</tbody></table></div>';
            } else {
                eventsHtml = `<p>${translations[currentLanguage].audit.noEvents}</p>`;
            }

            const existingEvents = auditSection.querySelector('.audit-events');
            if (existingEvents) {
                existingEvents.remove();
            }

            const eventsDiv = document.createElement('div');
            eventsDiv.className = 'audit-events';
            eventsDiv.innerHTML = eventsHtml;
            auditSection.appendChild(eventsDiv);
        }

        function logout() {
            currentToken = null;
            currentTenantId = null;
            localStorage.removeItem('authToken');
            localStorage.removeItem('currentTenantId');

            document.getElementById('tenantId').value = '';
            document.getElementById('limitsTenantId').value = '';

            showMessage('loginMessage', translations[currentLanguage].common.loggedOut, 'success');
            showSection('login');
        }

        function debugToken() {
            console.log('–¢–µ–∫—É—â–∏–π —Ç–æ–∫–µ–Ω:', currentToken);
            console.log('–¢–µ–∫—É—â–∏–π Tenant ID:', currentTenantId);

            if (currentToken) {
                try {
                    const payload = JSON.parse(atob(currentToken.split('.')[1]));
                    console.log('Payload —Ç–æ–∫–µ–Ω–∞:', payload);
                    console.log('–í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è:', new Date(payload.exp * 1000));
                } catch (e) {
                    console.log('–û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞:', e);
                }
            }
        }

        async function testPatientsCount() {
            try {
                console.log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–æ–¥—Å—á–µ—Ç –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤...');
                const response = await fetch(`${API_BASE_URL}/audit/patients-count`);
                const data = await response.json();

                console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–¥—Å—á–µ—Ç–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤:', data);

                if (response.ok) {
                    alert(`–ù–∞–π–¥–µ–Ω–æ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤: ${data.totalPatients}\n–¢–µ–Ω–∞–Ω—Ç–æ–≤: ${data.totalTenants}\n\n–î–µ—Ç–∞–ª–∏:\n${JSON.stringify(data.tenantStats, null, 2)}`);
                } else {
                    alert(`–û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}`);
                }
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:', error);
                alert(`–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`);
            }
        }

        window.addEventListener('error', function (e) {
            if (e.message.includes('CORS')) {
                console.warn('CORS –æ—à–∏–±–∫–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ backend —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è CORS.');
            }
        });
    </script>
</body>

</html>

</html>

</html>

</html>

</html>

</html>

</html>