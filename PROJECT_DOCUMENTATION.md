# HIS (Hospital Information System) - Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°

## Ðž Ð¿Ñ€Ð¾ÐµÐºÑ‚Ðµ

Ð­Ñ‚Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ HIS - Ð¼Ð½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð¾Ð¹ Ð¿Ð»Ð°Ñ‚Ñ„Ð¾Ñ€Ð¼Ñ‹ Ð´Ð»Ñ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð¾Ð»ÑŒÐ½Ð¸Ñ‡Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð° Ñ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð³Ð¾ ÑÑ‚ÐµÐºÐ° Ñ‚ÐµÑ…Ð½Ð¾Ð»Ð¾Ð³Ð¸Ð¹: NestJS, MongoDB Ð¸ RabbitMQ.

ÐšÐ»ÑŽÑ‡ÐµÐ²Ð°Ñ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ - Ð¿Ð¾Ð»Ð½Ð°Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð½Ñ‹Ð¼Ð¸ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ð¼Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸ (Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼Ð¸). ÐšÐ°Ð¶Ð´Ð°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð² Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ ÑÑ€ÐµÐ´Ðµ, Ð½Ðµ Ð¸Ð¼ÐµÑ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹. Ð”Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð²ÑÑ‚Ñ€Ð¾ÐµÐ½Ð½Ñ‹Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚, ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð¸ Ð½Ð°Ð´Ñ‘Ð¶Ð½ÑƒÑŽ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸ÑŽ.

## Ð‘Ñ‹ÑÑ‚Ñ€Ñ‹Ð¹ ÑÑ‚Ð°Ñ€Ñ‚

**Ð”Ð»Ñ Ð½Ð°Ñ‡Ð°Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:**

1. **Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ MongoDB** (Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ð¾ Ð¸Ð»Ð¸ Ð² Docker)
2. **ÐšÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹** Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ `npm install` Ð² Ð¿Ð°Ð¿ÐºÐµ `His`
3. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÑƒÑŽ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ**:
   ```bash
   curl -X POST http://localhost:3000/tenants/create-company \
     -H "Content-Type: application/json" \
     -d '{"companyName":"Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ Ð±Ð¾Ð»ÑŒÐ½Ð¸Ñ†Ð°","user":{"name":"ÐÐ´Ð¼Ð¸Ð½","email":"admin@test.ru","password":"123456"}}'
   ```
4. **Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð²Ñ…Ð¾Ð´ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ** Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ñ‚Ð¾ÐºÐµÐ½Ð°
5. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð¿ÐµÑ€Ð²Ð¾Ð³Ð¾ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°** Ð¸ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñƒ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

**ÐŸÐ¾ÑÐ»Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¸Ñ‚ÑŒ Ðº Ð¸Ð·ÑƒÑ‡ÐµÐ½Ð¸ÑŽ Ð¿Ð¾Ð»Ð½Ð¾Ð¹ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ð¸.**

## ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑÐ¾ÑÑ‚Ð¾Ð¸Ñ‚ Ð¸Ð· Ñ‚Ñ€Ñ‘Ñ… Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²:

### 1. **His** - Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ

Ð¦ÐµÐ½Ñ‚Ñ€Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹, Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‰Ð¸Ð¹ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 3000. Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ Ð²ÑÑŽ Ð¾ÑÐ½Ð¾Ð²Ð½ÑƒÑŽ Ð±Ð¸Ð·Ð½ÐµÑ-Ð»Ð¾Ð³Ð¸ÐºÑƒ Ð¸ API Ð´Ð»Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸, Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸, Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼Ð¸ Ð¸ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÑÐ¼Ð¸.

ÐšÐ°Ð¶Ð´Ð°Ñ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² MongoDB, Ñ‡Ñ‚Ð¾ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸.

### 2. **Producer** - ÑÐµÑ€Ð²Ð¸Ñ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

ÐžÑ‚Ð²ÐµÑ‡Ð°ÐµÑ‚ Ð·Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÑƒ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹ Ð² RabbitMQ. ÐŸÑ€Ð¸ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½Ð¾Ð²ÐµÐ½Ð¸Ð¸ Ð²Ð°Ð¶Ð½Ñ‹Ñ… ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€, ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð·Ð°ÐºÐ°Ð·Ð°) Producer Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð² Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ.

### 3. **Consumer** - ÑÐµÑ€Ð²Ð¸Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ð¹

ÐžÐ±Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð¸Ð· RabbitMQ. Ð’ Ñ‚ÐµÐºÑƒÑ‰ÐµÐ¹ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ ÑƒÐ´ÐµÐ»ÐµÐ½Ð¾ Ñ€Ð°Ð±Ð¾Ñ‚Ðµ Ñ Ð·Ð°ÐºÐ°Ð·Ð°Ð¼Ð¸, Ð¾Ð´Ð½Ð°ÐºÐ¾ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð»ÐµÐ³ÐºÐ¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ñ‚Ð¸Ð¿Ð¾Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹.

## ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð¼Ð¾Ð´ÑƒÐ»Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ His

### ðŸ¢ Tenants Module (Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼Ð¸)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/tenants/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ñ‹Ñ… Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ñ… Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹ (ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¹)
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¸Ð´ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¾Ñ€Ð¾Ð² Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð² (nanoid)
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ-Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð°Ñ‚Ð¾Ñ€Ð°
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð´Ð»Ñ JWT Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð²

**API Endpoints**:

```
POST /tenants/create-company - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸
```

**Ð¡Ñ…ÐµÐ¼Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…**:

```typescript
{
  companyName: string,  // ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸
  tenantId: string      // Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹ ID Ñ‚ÐµÐ½Ð°Ð½Ñ‚ï¿½ï¿½
}
```

### ðŸ‘¤ Users Module (Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/users/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ Ð¿Ñ€Ð¸Ð²ÑÐ·ÐºÐ¾Ð¹ Ðº Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ñƒ
- Ð¥ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹ (bcrypt)
- ÐŸÐ¾Ð¸ÑÐº Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ð¿Ð¾ email
- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ DTO

**DTO (Data Transfer Objects)**:

```typescript
// UserDto
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

**Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ**:

- `@IsNotEmpty()` - Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹
- `@IsString()` - Ð¿Ð¾Ð»Ñ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
- `@IsEmail()` - ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ email
- `@MinLength()` / `@MaxLength()` - Ð¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð¸Ñ Ð´Ð»Ð¸Ð½Ñ‹

**Ð¡Ñ…ÐµÐ¼Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ…**:

```typescript
{
  name: string,
  email: string,
  password: string,    // Ð¥ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ
  tenantId: string     // ÐŸÑ€Ð¸Ð²ÑÐ·ÐºÐ° Ðº Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ñƒ
}
```

### ðŸ” Auth Module (ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/auth/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
- Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ JWT Ñ‚Ð¾ÐºÐµÐ½Ð¾Ð² Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚-ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸
- Ð¨Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ/Ð´ÐµÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹
- Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ñ… ÐºÐ»ÑŽÑ‡ÐµÐ¹ Ð´Ð»Ñ Ð½Ð¾Ð²Ñ‹Ñ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²

**API Endpoints**:

```
POST /auth/login - Ð’Ñ…Ð¾Ð´ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ
```

**ÐŸÑ€Ð¾Ñ†ÐµÑÑ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸**:

1. ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
2. Ð¡Ñ€Ð°Ð²Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹
3. ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐµÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÐºÐ»ÑŽÑ‡Ð° Ð´Ð»ï¿½ï¿½ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
4. Ð“ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ JWT Ñ‚Ð¾ÐºÐµÐ½Ð°
5. Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ Ñ‚Ð¾ÐºÐµÐ½Ð° Ð¸ tenantId

### ðŸ¥ Patients Module (Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°Ð¼Ð¸)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/patients/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ CRUD Ð´Ð»Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð² (ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ, Ñ‡Ñ‚ÐµÐ½Ð¸Ðµ, Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ, ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ðµ)
- Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼Ð¸
- Ð—Ð°Ñ‰Ð¸Ñ‚Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹
- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒÑŽ DTO
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð°Ð¼Ð¸
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ObjectId Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

**API Endpoints**:

```
GET /patients - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð² (Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ð¸)
GET /patients/:id - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð° Ð¿Ð¾ ID
POST /patients - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
PUT /patients/:id - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
DELETE /patients/:id - Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
```

**DTO (Data Transfer Objects)**:

```typescript
// CreatePatientDto
{
  name: string,     // ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ, ÑÑ‚Ñ€Ð¾ÐºÐ°, 2-50 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
  surname: string,  // ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ, ÑÑ‚Ñ€Ð¾ÐºÐ°, 2-50 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²
  age: number       // ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ, Ñ‡Ð¸ÑÐ»Ð¾, Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 0
}

// UpdatePatientDto - Ð½Ð°ÑÐ»ÐµÐ´ÑƒÐµÑ‚ Ð¾Ñ‚ CreatePatientDto, Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹
```

**Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ**:

- `@IsNotEmpty()` - Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹ Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸
- `@IsString()` - name Ð¸ surname Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÑÑ‚Ñ€Ð¾ÐºÐ°Ð¼Ð¸
- `@IsInt()` - age Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ñ‡Ð¸ÑÐ»Ð¾Ð¼
- `@Min(0)` - Ð²Ð¾Ð·Ñ€Ð°ÑÑ‚ Ð½Ðµ Ð¼Ð¾Ð¶ÐµÑ‚ Ð±Ñ‹Ñ‚ÑŒ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¼
- `@Type(() => Number)` - Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ñ€ÐµÐ¾Ð±Ñ€Ð°Ð·Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÑ‚Ñ€Ð¾ÐºÐ¸ Ð² Ñ‡Ð¸ÑÐ»Ð¾

**ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸**:

- MongoDB Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ `_id` Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ´ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼/ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸ÐµÐ¼
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÑ‡ÐµÑ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸/ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸
- ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ (404 Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð²)

### ðŸ“Š Limits Module (Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð°Ð¼Ð¸)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/limits/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð´Ð»Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð² (Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ñ‹, Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð´Ð°Ð½Ð½Ñ‹Ñ…, Ð·Ð°Ð¿Ñ€Ð¾ÑÑ‹)
- ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
- Ð‘Ð»Ð¾ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° Ð¿Ñ€Ð¸ Ð¿Ñ€ÐµÐ²Ñ‹ÑˆÐµÐ½Ð¸Ð¸ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð²

**API Endpoints**:

```
GET /limits/:tenantId - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
PUT /limits/:tenantId - Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
GET /limits/usage/:tenantId - Ð¡Ñ‚Ð°Ñ‚Ð¸ÑÑ‚Ð¸ÐºÐ° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ
```

**Ð¢Ð¸Ð¿Ñ‹ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð²**:

- `maxDocuments` - ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²
- `maxDataSizeKB` - ÐœÐ°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ñ€Ð°Ð·Ð¼ÐµÑ€ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² KB
- `monthlyQueries` - ÐšÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð² Ð² Ð¼ÐµÑÑÑ†

### ðŸ“ Audit Module (ÐÑƒÐ´Ð¸Ñ‚)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/audit/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… HTTP Ð·Ð°Ð¿Ñ€Ð¾ÑÐ¾Ð²
- ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚Ð° Ð² RabbitMQ
- Ð¡Ð°Ð½Ð¸Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÑƒÐ²ÑÑ‚Ð²Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð¿Ð°Ñ€Ð¾Ð»Ð¸, Ñ‚Ð¾ÐºÐµÐ½Ñ‹)

**Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð°ÑƒÐ´Ð¸Ñ‚Ð°**:

- Ð’Ñ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ Ð¼ÐµÑ‚ÐºÐ°
- ID Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¸ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
- HTTP Ð¼ÐµÑ‚Ð¾Ð´ Ð¸ Ð¿ÑƒÑ‚ÑŒ
- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ ÐºÐ¾Ð´ Ð¸ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
- IP Ð°Ð´Ñ€ÐµÑ Ð¸ User-Agent
- Ð¢ÐµÐ»Ð¾ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ° (Ñ ÑÐ°Ð½Ð¸Ñ‚Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹)

### ðŸ”„ Proxy Module (ÐŸÑ€Ð¾ÐºÑÐ¸)

**Ð¤Ð°Ð¹Ð»Ñ‹**: `src/proxy/`

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ**:

- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
- Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ health check endpoint

**API Endpoints**:

```
GET /proxy/health - ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ
```

## ÐœÐ½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

ÐœÐ½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚ÑŒ ÑÐ²Ð»ÑÐµÑ‚ÑÑ ÐºÐ»ÑŽÑ‡ÐµÐ²Ð¾Ð¹ Ð¾ÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚ÑŒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹. ÐžÐ½Ð° Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ð¼Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸ - ÐºÐ°Ð¶Ð´Ð°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð½ÐµÐ·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾, Ð½Ðµ Ð¸Ð¼ÐµÑ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Ð´Ð°Ð½Ð½Ñ‹Ð¼ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¹.

### ÐŸÑ€Ð¸Ð½Ñ†Ð¸Ð¿ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹

1. **Ð˜Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…**:

   - ÐšÐ°Ð¶Ð´Ð°Ñ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÑ‚ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… MongoDB
   - ÐŸÑ€Ð¸Ð¼ÐµÑ€: "Ð‘Ð¾Ð»ÑŒÐ½Ð¸Ñ†Ð° Ð¡Ð¾Ð»Ð½Ñ‹ÑˆÐºÐ¾" â†’ Ð±Ð°Ð·Ð° `tenant_abc123`
   - ÐŸÐ¾Ð»Ð½Ð¾Ðµ Ñ€Ð°Ð·Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸

2. **Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ðµ Ð¸Ð¼ÐµÐ½Ð¾Ð²Ð°Ð½Ð¸Ðµ**:

   - Ð¤Ð¾Ñ€Ð¼Ð°Ñ‚ Ð¸Ð¼ÐµÐ½Ð¸ Ð±Ð°Ð·Ñ‹: `tenant_{tenantId}`
   - ÐžÐ±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ñ€ÐµÐ´ÑÐºÐ°Ð·ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ Ð¸ ÑƒÐ´Ð¾Ð±ÑÑ‚Ð²Ð¾ Ð°Ð´Ð¼Ð¸Ð½Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

3. **Middleware Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸**:

   - ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ð¹ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº `X-TENANT-ID`
   - ÐŸÑ€Ð¸ Ð½ÐµÐ²Ð°Ð»Ð¸Ð´Ð½Ð¾Ð¼ ID Ð¸Ð»Ð¸ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ð¸ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ð±Ð»Ð¾ÐºÐ¸Ñ€ÑƒÐµÑ‚ÑÑ

4. **Ð”Ð¸Ð½Ð°Ð¼Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ**:
   - ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ð¼ÐµÐ¶Ð´Ñƒ Ð±Ð°Ð·Ð°Ð¼Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
   - ÐŸÑ€Ð¾Ð·Ñ€Ð°Ñ‡Ð½Ð¾ÑÑ‚ÑŒ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ° - ÑÐ¸ÑÑ‚ÐµÐ¼Ð° ÑÐ°Ð¼Ð° Ð¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÑÐµÑ‚ Ð½ÑƒÐ¶Ð½ÑƒÑŽ Ð±Ð°Ð·Ñƒ

### ÐšÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ñ‹ Ð¼Ð½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸

#### TenantMiddleware

- Ð˜Ð·Ð²Ð»ÐµÐºÐ°ÐµÑ‚ `tenantId` Ð¸Ð· Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ° `X-TENANT-ID`
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
- Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÑ‚ `tenantId` Ð² Ð¾Ð±ÑŠÐµÐºÑ‚ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°

#### TenantConnectionProvider

- Ð¡Ð¾Ð·Ð´Ð°ÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð±Ð°Ð·Ð°Ð¼ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð¾Ð²
- Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ request-scoped Ð¿Ñ€Ð¾Ð²Ð°Ð¹Ð´ÐµÑ€Ñ‹
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿ÐµÑ€ÐµÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ÑÑ Ð¼ÐµÐ¶Ð´Ñƒ Ð±Ð°Ð·Ð°Ð¼Ð¸

#### TenantAuthenticationGuard

- ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ JWT Ñ‚Ð¾ÐºÐµÐ½Ñ‹ Ñ Ñ‚ÐµÐ½Ð°Ð½Ñ‚-ÑÐ¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ð¼Ð¸ ÐºÐ»ÑŽÑ‡Ð°Ð¼Ð¸
- ÐžÐ±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ Ð½Ð° ÑƒÑ€Ð¾Ð²Ð½Ðµ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°

## Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸

### Ð¨Ð¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ

- **ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼**: Cryptr Ð´Ð»Ñ ÑÐ¸Ð¼Ð¼ÐµÑ‚Ñ€Ð¸Ñ‡Ð½Ð¾Ð³Ð¾ ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ
- **ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ**: Ð¡ÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ JWT Ñ‚Ð¾ÐºÐµÐ½Ð¾ï¿½ï¿½
- **ÐšÐ»ÑŽÑ‡ ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ**: Ð¥Ñ€Ð°Ð½Ð¸Ñ‚ÑÑ Ð² Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ

### JWT Ñ‚Ð¾ÐºÐµÐ½Ñ‹

- **Ð£Ð½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸**: ÐšÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚ Ð¸Ð¼ÐµÐµÑ‚ ÑÐ²Ð¾Ð¹ ÑÐµÐºÑ€ÐµÑ‚Ð½Ñ‹Ð¹ ÐºÐ»ÑŽÑ‡
- **Ð’Ñ€ÐµÐ¼Ñ Ð¶Ð¸Ð·Ð½Ð¸**: 10 Ñ‡Ð°ÑÐ¾Ð²
- **Ð¡Ð¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ**: userId Ð² payload

### Ð¥ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¹

- **ÐÐ»Ð³Ð¾Ñ€Ð¸Ñ‚Ð¼**: bcrypt
- **Ð Ð°ÑƒÐ½Ð´Ñ‹**: 10

## ÐœÐ¸ÐºÑ€Ð¾ÑÐµÑ€Ð²Ð¸ÑÐ½Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

### Producer Service

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸**:

- ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð² RabbitMQ
- ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ ÑÐ¿Ð¸ÑÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð¾Ð²
- Ð­Ð¼Ð¸ÑÑÐ¸Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ `order-placed`

**API**:

```
POST /orders - Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð°
GET /orders - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²
```

### Consumer Service

**Ð¤ÑƒÐ½ÐºÑ†Ð¸Ð¸**:

- ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ `order-placed`
- Ð¥Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð·Ð°ÐºÐ°Ð·Ð¾Ð² Ð² Ð¿Ð°Ð¼ÑÑ‚Ð¸
- ÐŸÑ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ API Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²

**ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸**:

- `handleOrderPlaced` - ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð½Ð¾Ð²Ñ‹Ñ… Ð·Ð°ÐºÐ°Ð·Ð¾Ð²
- `getOrders` - Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‚ ÑÐ¿Ð¸ÑÐºÐ° Ð·Ð°ÐºÐ°Ð·Ð¾Ð²

## ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð¸ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ

### ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ (.env)

```
PORT=3000
DATABASE_CONNECTION_STRING=mongodb://localhost:27017/his
SECURITY_ENCRYPTION_SECRET_KEY=your-encryption-key
```

### Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸

**ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ**:

- NestJS (Ñ„Ñ€ÐµÐ¹Ð¼Ð²Ð¾Ñ€Ðº)
- Mongoose (MongoDB ODM)
- JWT (Ð°ÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ)
- bcrypt (Ñ…ÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ)
- nanoid (Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ñ ID)
- cryptr (ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ)
- RabbitMQ (ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ)

### Ð—Ð°Ð¿ÑƒÑÐº ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

```bash
# ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
cd His
npm run start:dev

# Producer
cd producer
npm run start:dev

# Consumer
cd consumer
npm run start:dev
```

## API Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸

```http
POST /tenants/create-company
Content-Type: application/json

{
  "companyName": "Ð“Ð¾Ñ€Ð¾Ð´ÑÐºÐ°Ñ Ð±Ð¾Ð»ÑŒÐ½Ð¸Ñ†Ð° â„–1",
  "user": {
    "name": "Ð˜Ð²Ð°Ð½ Ð˜Ð²Ð°Ð½Ð¾Ð²",
    "email": "admin@hospital1.ru",
    "password": "securepassword"
  }
}
```

### ÐÑƒÑ‚ÐµÐ½Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ

```http
POST /auth/login
Content-Type: application/json

{
  "email": "admin@hospital1.ru",
  "password": "securepassword"
}
```

### ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð²

```http
GET /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð°Ð¼Ð¸

```http
PUT /limits/{tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "maxDocuments": 5000,
  "maxDataSizeKB": 102400,
  "monthlyQueries": 10000
}
```

## ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸

### ÐŸÑ€ÐµÐ¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°

1. **ÐŸÐ¾Ð»Ð½Ð°Ñ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…** Ð¼ÐµÐ¶Ð´Ñƒ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°Ð¼Ð¸
2. **ÐœÐ°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ** - ÐºÐ°Ð¶Ð´Ñ‹Ð¹ Ñ‚ÐµÐ½Ð°Ð½Ñ‚ Ð¼Ð¾Ð¶ÐµÑ‚ Ð¸Ð¼ÐµÑ‚ÑŒ ÑÐ²Ð¾ÑŽ Ð±Ð°Ð·Ñƒ
3. **Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ** - ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð´Ð»Ñ ÐºÐ°Ð¶Ð´Ð¾Ð³Ð¾ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°
4. **ÐÑƒÐ´Ð¸Ñ‚** - Ð¿Ð¾Ð»Ð½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹
5. **ÐšÐ¾Ð½Ñ‚Ñ€Ð¾Ð»ÑŒ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²** - ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð¿Ñ€ÐµÐ´Ð¾Ñ‚Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð·Ð»Ð¾ÑƒÐ¿Ð¾Ñ‚Ñ€ÐµÐ±Ð»ÐµÐ½Ð¸Ñ

### ÐŸÐ¾Ñ‚ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ñ‹Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ

2. **ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº** - Ñ†ÐµÐ½Ñ‚Ñ€Ð°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
3. **ÐšÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** - Redis Ð´Ð»Ñ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
4. **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³** - Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð°Ð¼Ð¸ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð°
5. **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ** - Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ðµ unit Ð¸ integration Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸

## ÐÐ¾Ð²Ñ‹Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ

### âœ… Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…

**Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð° Ð¿Ð¾Ð»Ð½Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð²ÑÐµÑ… DTO:**

#### UserDto

```typescript
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

#### CreateCompanyDto

```typescript
{
  companyName: string,  // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(100)
  user: UserDto         // @ValidateNested, @Type(() => UserDto)
}
```

#### LoginCredentialsDto

```typescript
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}
```

#### UpdateCredentialsDto

```typescript
// ÐÐ°ÑÐ»ÐµÐ´ÑƒÐµÑ‚ Ð¾Ñ‚ LoginCredentialsDto, Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹
```

### âœ… ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ CRUD Ð´Ð»Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð¾Ð²

**ÐÐ¾Ð²Ñ‹Ðµ endpoints:**

```
GET /patients/:id     - ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð° Ð¿Ð¾ ID
PUT /patients/:id     - ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
DELETE /patients/:id  - Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°
```

**ÐžÑÐ¾Ð±ÐµÐ½Ð½Ð¾ÑÑ‚Ð¸:**

- Ð’Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ ObjectId Ð´Ð»Ñ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ´ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸ÑÐ¼Ð¸
- ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð¿Ñ€Ð¸ ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ð¸
- ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹ (404 Ð´Ð»Ñ Ð½ÐµÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ñ… Ð·Ð°Ð¿Ð¸ÑÐµÐ¹)

### âœ… Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° DTO

**Ð¡Ñ‚Ð°Ð½Ð´Ð°Ñ€Ñ‚Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ð¾ Ñ‚Ð¸Ð¿Ñƒ Patient DTO:**

- `CreateXxxDto` - Ð´Ð»Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Ð·Ð°Ð¿Ð¸ÑÐµÐ¹ (Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹)
- `UpdateXxxDto extends PartialType(CreateXxxDto)` - Ð´Ð»Ñ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ (Ð²ÑÐµ Ð¿Ð¾Ð»Ñ Ð¾Ð¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ‹)

### âœ… ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÐºÐ¾Ð´Ð°

**Ð£Ð´Ð°Ð»ÐµÐ½Ñ‹ Ð²ÑÐµ Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸:**

- Ð ÑƒÑÑÐºÐ¸Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ - Ð¿Ð¾Ð»Ð½Ð¾ÑÑ‚ÑŒÑŽ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹
- ÐÐ½Ð³Ð»Ð¸Ð¹ÑÐºÐ¸Ðµ Ð¾Ð±ÑŠÑÑÐ½ÑÑŽÑ‰Ð¸Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ - ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹
- Ð—Ð°ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ - ÑƒÐ´Ð°Ð»ÐµÐ½
- Ð˜Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸Ð¸ - ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹

**Ð ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**

- ÐšÐ¾Ð´ ÑÑ‚Ð°Ð» Ñ‡Ð¸Ñ‰Ðµ Ð¸ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½ÐµÐµ
- Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð° Ñ‡Ð¸Ñ‚Ð°ÐµÐ¼Ð¾ÑÑ‚ÑŒ
- Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð»Ð¸Ð½Ñ‚ÐµÑ€Ð°

### âœ… ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ValidationPipe

**Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ Ð² main.ts:**

```typescript
app.useGlobalPipes(
  new ValidationPipe({
    whitelist: true, // Ð£Ð´Ð°Ð»ÑÐµÑ‚ ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð° Ð±ÐµÐ· Ð´ÐµÐºÐ¾Ñ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð²
    forbidNonWhitelisted: true, // Ð’Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÑƒ Ð¿Ñ€Ð¸ Ð»Ð¸ÑˆÐ½Ð¸Ñ… ÑÐ²Ð¾Ð¹ÑÑ‚Ð²Ð°Ñ…
  })
);
```

### âœ… ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº

**Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº:**

- `NotFoundException` Ð²Ð¼ÐµÑÑ‚Ð¾ Ð¾Ð±Ñ‹Ñ‡Ð½Ð¾Ð³Ð¾ `Error`
- ÐŸÑ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ HTTP ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹
- ÐŸÐ¾Ð½ÑÑ‚Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð½Ð° Ñ€ÑƒÑÑÐºÐ¾Ð¼ ÑÐ·Ñ‹ÐºÐµ

## ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ Ð½Ð¾Ð²Ñ‹Ñ… API

### Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°

```http
POST /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "Ð˜Ð²Ð°Ð½",
  "surname": "Ð˜Ð²Ð°Ð½Ð¾Ð²",
  "age": 30
}
```

### ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°

```http
PUT /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "ÐÐ¾Ð²Ð¾Ðµ Ð¸Ð¼Ñ",
  "age": 31
}
```

### Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð°Ñ†Ð¸ÐµÐ½Ñ‚Ð°

```http
DELETE /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### ÐžÑ‚Ð²ÐµÑ‚Ñ‹ Ð¿Ñ€Ð¸ Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ð¸

```json
{
  "statusCode": 400,
  "message": [
    "Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ð¾Ð±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾",
    "ÐÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¹ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ email",
    "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼ÑƒÐ¼ 6 ÑÐ¸Ð¼Ð²Ð¾Ð»Ð¾Ð²"
  ],
  "error": "Bad Request"
}
```

## Ð—Ð°ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

HIS Ð¿Ñ€ÐµÐ´ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ ÑÐ¾Ð±Ð¾Ð¹ ÑÐ¾Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ Ð¼Ð½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½ÑƒÑŽ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð±Ð¾Ð»ÑŒÐ½Ð¸Ñ‡Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÐµÐ¹ Ñ Ð°ÐºÑ†ÐµÐ½Ñ‚Ð¾Ð¼ Ð½Ð° Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ, Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¸ Ð¼Ð°ÑÑˆÑ‚Ð°Ð±Ð¸Ñ€ÑƒÐµÐ¼Ð¾ÑÑ‚ÑŒ. Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð²ÐºÐ»ÑŽÑ‡Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ…, CRUD Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ð²ÑÐµÑ… ÑÑƒÑ‰Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¸ Ð¿Ñ€Ð¾Ñ„ÐµÑÑÐ¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ Ð¾Ñ„Ð¾Ñ€Ð¼Ð»ÐµÐ½Ð½Ñ‹Ð¹ ÐºÐ¾Ð´ Ð±ÐµÐ· Ð¸Ð·Ð±Ñ‹Ñ‚Ð¾Ñ‡Ð½Ñ‹Ñ… ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÐµÐ².

ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð° Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÐµÑ‚ Ð»ÐµÐ³ÐºÐ¾ Ð´Ð¾Ð±Ð°Ð²Ð»ÑÑ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ðµ Ð¼ÐµÐ´Ð¸Ñ†Ð¸Ð½ÑÐºÐ¸Ðµ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð±ÐµÐ· Ð²Ð»Ð¸ÑÐ½Ð¸Ñ Ð½Ð° ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸ Ð¾Ð±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ð¹ ÑƒÑ€Ð¾Ð²ÐµÐ½ÑŒ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚Ð¸ Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ð´Ð¸Ð²Ð¸Ð´ÑƒÐ°Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ»ÑŽÑ‡Ð¸ ÑˆÐ¸Ñ„Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ð¸ Ð¸Ð·Ð¾Ð»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ….

---

## ÐžÑ†ÐµÐ½ÐºÐ° Ñ‚ÐµÐºÑƒÑ‰ÐµÐ³Ð¾ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

### Ð ÐµÐ°Ð»Ð¸Ð·Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

- **ÐœÐ½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð°Ñ Ð°Ñ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°**: ÐžÐ±ÐµÑÐ¿ÐµÑ‡Ð¸Ð²Ð°ÐµÑ‚ Ð¿Ð¾Ð»Ð½ÑƒÑŽ Ð¸Ð·Ð¾Ð»ÑÑ†Ð¸ÑŽ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¼ÐµÐ¶Ð´Ñƒ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑÐ¼Ð¸
- **ÐšÐ¾Ð¼Ð¿Ð»ÐµÐºÑÐ½Ð°Ñ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸Ñ**: Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð²ÑÐµ Ð²Ñ…Ð¾Ð´ÑÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð½Ð° ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²Ð¸Ðµ Ñ‚Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸ÑÐ¼
- **Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð²**: ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð¿ÐµÑ€ÐµÐ³Ñ€ÑƒÐ·ÐºÐ¸ Ñ€ÐµÑÑƒÑ€ÑÐ¾Ð²
- **ÐŸÐ¾Ð»Ð½Ñ‹Ð¹ Ð°ÑƒÐ´Ð¸Ñ‚**: Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð»Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð²ÑÐµÑ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹ Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ

### ÐŸÐ»Ð°Ð½Ñ‹ Ð¿Ð¾ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸ÑŽ

- **ÐšÐµÑˆÐ¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**: Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ñ Redis Ð´Ð»Ñ Ð¿Ð¾Ð²Ñ‹ÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
- **Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ**: Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ unit Ð¸ integration Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸
- **ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³**: Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼ Ð¼Ð¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³Ð° Ð¸ Ð°Ð»ÐµÑ€Ñ‚Ð¸Ð½Ð³Ð°
- **ÐœÐ°ÑÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° Ð´Ð°Ð½Ð½Ñ‹Ñ…**: Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð´Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ð½Ñ„Ð¸Ð´ÐµÐ½Ñ†Ð¸Ð°Ð»ÑŒÐ½Ð¾Ð¹

### Ð Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹

```bash
# ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
cd His
npm install
npm run start:dev

# Producer (Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸)
cd ../producer
npm install
npm run start:dev

# Consumer (Ð¿Ñ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸)
cd ../consumer
npm install
npm run start:dev
```

**Ð¢Ñ€ÐµÐ±Ð¾Ð²Ð°Ð½Ð¸Ñ**: ÐŸÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ MongoDB Ð¸ RabbitMQ.

### Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

1. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ MongoDB Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð° Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð°
2. ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ… Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ
3. Ð˜Ð·ÑƒÑ‡Ð¸Ñ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº
4. ÐŸÑ€Ð¸ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½Ð¾Ð²ÐµÐ½Ð¸Ð¸ ÑÐ»Ð¾Ð¶Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ñ€Ð°Ð·Ð´ÐµÐ»Ñƒ Issues

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð²

**Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð³Ð¾ Ð¼Ð¾Ð´ÑƒÐ»Ñ:**

1. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñƒ Ð¼Ð¾Ð´ÑƒÐ»Ñ `patients/` ÐºÐ°Ðº ÑˆÐ°Ð±Ð»Ð¾Ð½
2. Ð—Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ `Patient` Ð½Ð° Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ðµ Ð²Ð°ÑˆÐµÐ¹ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚Ð¸
3. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰ÑƒÑŽ Ð²Ð°Ð»Ð¸Ð´Ð°Ñ†Ð¸ÑŽ Ð² DTO
4. ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ð¾Ð¹ Ð»Ð¸Ð¼Ð¸Ñ‚Ð¾Ð² Ð¸ Ð°ÑƒÐ´Ð¸Ñ‚Ð°

**ÐžÑ‚Ð»Ð°Ð´ÐºÐ° Ð¼Ð½Ð¾Ð³Ð¾Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð½Ð¾ÑÑ‚Ð¸:**

- Ð’ÑÐµÐ³Ð´Ð° Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð·Ð°Ð³Ð¾Ð»Ð¾Ð²ÐºÐ° `X-TENANT-ID` Ð² Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°Ñ…
- Ð›Ð¾Ð³Ð¸ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¿Ð¾ÐºÐ°Ð·Ñ‹Ð²Ð°ÑŽÑ‚, Ðº ÐºÐ°ÐºÐ¾Ð¹ Ð±Ð°Ð·Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð¸ÑÑ…Ð¾Ð´Ð¸Ñ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ
- ÐŸÑ€Ð¸ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½Ð¾Ð²ÐµÐ½Ð¸Ð¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ‚ÐµÐ½Ð°Ð½Ñ‚Ð°

**ÐžÐ¿Ñ‚Ð¸Ð¼Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸:**

- MongoDB Ð¸Ð½Ð´ÐµÐºÑÑ‹ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸
- ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð»Ð¸Ð¼Ð¸Ñ‚Ñ‹ Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð½Ð¾ÑÑ‚ÐµÐ¹ Ð¾Ñ€Ð³Ð°Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
- ÐÑƒÐ´Ð¸Ñ‚ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾ Ð¸ Ð½Ðµ Ð²Ð»Ð¸ÑÐµÑ‚ Ð½Ð° Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚ÑŒ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¹

### ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ð¸ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ

Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ð° Ñ ÑƒÑ‡Ñ‘Ñ‚Ð¾Ð¼ Ð¿Ñ€Ð¸Ð½Ñ†Ð¸Ð¿Ð¾Ð² Ñ€Ð°ÑÑˆÐ¸Ñ€ÑÐµÐ¼Ð¾ÑÑ‚Ð¸ Ð¸ Ð¼Ð¾Ð´ÑƒÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸. Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¿Ð¾ ÐºÐ¾Ð´Ñƒ Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸ÑŽ - Ð¼Ñ‹ Ð¾Ñ‚ÐºÑ€Ñ‹Ñ‚Ñ‹ Ð´Ð»Ñ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸Ñ‡ÐµÑÑ‚Ð²Ð°.

Ð”Ð»Ñ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¾Ð± Ð¾ÑˆÐ¸Ð±ÐºÐ°Ñ… Ð¸Ð»Ð¸ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ¸ÑÑ‚ÐµÐ¼Ñƒ Issues Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°.

---

# HIS (Hospital Information System) - Project Documentation

## About the Project

This is documentation for the HIS system - a multi-tenant platform for hospital information management. The system is developed using modern technology stack: NestJS, MongoDB, and RabbitMQ.

The key feature of the system is complete data isolation between different medical organizations (tenants). Each organization operates in an isolated environment without access to other organizations' data. Additionally, the system includes built-in auditing, resource limits, and robust authentication.

## Quick Start

**To get started, follow these steps:**

1. **Start MongoDB** (locally or in Docker)
2. **Clone the repository** and run `npm install` in the `His` folder
3. **Create your first medical organization**:
   ```bash
   curl -X POST http://localhost:3000/tenants/create-company \
     -H "Content-Type: application/json" \
     -d '{"companyName":"Test Hospital","user":{"name":"Admin","email":"admin@test.ru","password":"123456"}}'
   ```
4. **Log into the system** to get a token
5. **Create your first patient** and verify the system works

**After successful startup, you can proceed to study the full documentation.**

## System Architecture

The system consists of three main components:

### 1. **His** - Main Application

The central component of the system, running on port 3000. Contains all core business logic and APIs for working with patients, users, tenants, and other entities.

Each medical organization gets a separate MongoDB database, ensuring complete data isolation between organizations.

### 2. **Producer** - Message Sending Service

Responsible for sending messages to RabbitMQ. When important events occur (e.g., creating a new order), Producer sends corresponding events to the queue.

### 3. **Consumer** - Message Processing Service

Processes incoming events from RabbitMQ. The current implementation focuses mainly on order handling, but the architecture allows easy addition of other event types.

## Core System Modules

### ðŸ¢ Tenants Module - New Hospital Registration

**Location**: `src/tenants/`

When a new hospital wants to join our system, it goes through this module. We:

- Create a unique ID for the hospital (using nanoid - very reliable)
- Automatically create an administrator for this hospital
- Generate a secret key for JWT tokens
- Set up default limits

**How to use**:

```bash
POST /tenants/create-company
```

Just send the hospital name and administrator data, and we'll set everything up automatically.

**What to send**:

```typescript
{
  companyName: "City Hospital #1",  // Hospital name
  user: {
    name: "Ivan Petrov",
    email: "admin@hospital1.ru",
    password: "securepassword123"
  }
}
```

### ðŸ‘¤ Users Module - User Management

**Location**: `src/users/`

**Functionality**:

- Create users with tenant binding
- Password hashing (bcrypt)
- Find users by email
- Data validation with DTO

**DTO (Data Transfer Objects)**:

```typescript
// UserDto
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

**Validation**:

- `@IsNotEmpty()` - all fields are required
- `@IsString()` - fields must be strings
- `@IsEmail()` - correct email format
- `@MinLength()` / `@MaxLength()` - length constraints

**Data Schema**:

```typescript
{
  name: string,
  email: string,
  password: string,    // Hashed password
  tenantId: string     // Tenant binding
}
```

### ðŸ” Auth Module - Authentication

**Location**: `src/auth/`

**Functionality**:

- User authentication
- JWT token generation with tenant-specific secret keys
- Secret key encryption/decryption
- Secret key creation for new tenants
- Login data validation

**API Endpoints**:

```
POST /auth/login - System login
```

**DTO (Data Transfer Objects)**:

```typescript
// LoginCredentialsDto
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}

// UpdateCredentialsDto extends PartialType(LoginCredentialsDto)
```

**Authentication Process**:

1. Input data validation
2. Check if user exists
3. Compare passwords
4. Get secret key for tenant
5. Generate JWT token
6. Return token and tenantId

### ðŸ¥ Patients Module - Patient Management

**Location**: `src/patients/`

**Functionality**:

- Full CRUD for patients (create, read, update, delete)
- Data isolation between tenants
- Authorization protection
- Data validation with DTO
- Automatic limit management
- ObjectId validation for security

**API Endpoints**:

```
GET /patients - Get list of patients (requires authentication)
GET /patients/:id - Get patient by ID
POST /patients - Create new patient
PUT /patients/:id - Update patient data
DELETE /patients/:id - Delete patient
```

**DTO (Data Transfer Objects)**:

```typescript
// CreatePatientDto
{
  name: string,     // Required, string, 2-50 characters
  surname: string,  // Required, string, 2-50 characters
  age: number       // Required, number, minimum 0
}

// UpdatePatientDto - inherits from CreatePatientDto, all fields optional
```

**Validation**:

- `@IsNotEmpty()` - all fields required for creation
- `@IsString()` - name and surname must be strings
- `@IsInt()` - age must be a number
- `@Min(0)` - age cannot be negative
- `@Type(() => Number)` - automatic string to number conversion

**Features**:

- MongoDB automatically generates `_id` for each patient
- Check patient existence before update/delete operations
- Automatic limit counter updates on creation/deletion
- Proper HTTP statuses (404 for non-existent patients)

### ðŸ“Š Limits Module - Limit Management

**Location**: `src/limits/`

**Functionality**:

- Set limits for tenants (documents, data size, queries)
- Monitor resource usage
- Block on limit exceedance

**API Endpoints**:

```
GET /limits/:tenantId - Get tenant limits
PUT /limits/:tenantId - Set tenant limits
GET /limits/usage/:tenantId - Usage statistics
```

**Limit Types**:

- `maxDocuments` - Maximum number of documents
- `maxDataSizeKB` - Maximum data size in KB
- `monthlyQueries` - Number of queries per month

### ðŸ“ Audit Module - Auditing

**Location**: `src/audit/`

**Functionality**:

- Log all HTTP requests
- Send audit events to RabbitMQ
- Sanitize sensitive data (passwords, tokens)

**Audit Data**:

- Timestamp
- User and tenant ID
- HTTP method and path
- Status code and execution time
- IP address and User-Agent
- Request body (with sanitization)

### ðŸ”„ Proxy Module - Proxy

**Location**: `src/proxy/`

**Functionality**:

- System status check
- Basic health check endpoint

**API Endpoints**:

```
GET /proxy/health - Status check
```

## Multi-Tenant Architecture

Multi-tenancy is a key feature of the system. It ensures complete data isolation between different medical organizations - each organization operates independently without access to other organizations' data.

### How It Works

1. **Database-level isolation**:

   - Each organization gets a separate MongoDB database
   - Example: "Sunshine Hospital" â†’ database `tenant_abc123`
   - Complete data separation between organizations

2. **Standardized naming**:

   - Database name format: `tenant_{tenantId}`
   - Ensures predictability and ease of administration

3. **Middleware validation**:

   - Each incoming request checks the `X-TENANT-ID` header
   - Access is blocked for invalid ID or non-existent organization

4. **Dynamic connection**:
   - Automatic switching between tenant databases
   - Transparency for developer - system determines the required database

### Multi-Tenancy Components

#### TenantMiddleware

- Extracts `tenantId` from `X-TENANT-ID` header
- Checks tenant existence
- Adds `tenantId` to request object

#### TenantConnectionProvider

- Creates connections to tenant databases
- Uses request-scoped providers
- Automatically switches between databases

#### TenantAuthenticationGuard

- Validates JWT tokens with tenant-specific keys
- Ensures tenant-level security

## Security System

### Encryption

- **Algorithm**: Cryptr for symmetric encryption
- **Application**: JWT token secret keys
- **Encryption key**: Stored in environment variables

### JWT Tokens

- **Unique keys**: Each tenant has its own secret key
- **Lifetime**: 10 hours
- **Content**: userId in payload

### Password Hashing

- **Algorithm**: bcrypt
- **Rounds**: 10

## Microservice Architecture

### Producer Service

**Functions**:

- Send orders to RabbitMQ
- Get list of orders
- Emit `order-placed` events

**API**:

```
POST /orders - Create order
GET /orders - Get orders
```

### Consumer Service

**Functions**:

- Process `order-placed` events
- Store orders in memory
- Provide API for getting orders

**Handlers**:

- `handleOrderPlaced` - Process new orders
- `getOrders` - Return order list

## Configuration and Deployment

### Environment Variables (.env)

```
PORT=3000
DATABASE_CONNECTION_STRING=mongodb://localhost:27017/his
SECURITY_ENCRYPTION_SECRET_KEY=your-encryption-key
```

### Dependencies

**Core**:

- NestJS (framework)
- Mongoose (MongoDB ODM)
- JWT (authentication)
- bcrypt (hashing)
- nanoid (ID generation)
- cryptr (encryption)
- RabbitMQ (messaging)

### System Startup

```bash
# Main application
cd His
npm run start:dev

# Producer (if needed)
cd producer
npm run start:dev

# Consumer (if needed)
cd consumer
npm run start:dev
```

## API Documentation

### Creating a Company

```http
POST /tenants/create-company
Content-Type: application/json

{
  "companyName": "City Hospital #1",
  "user": {
    "name": "Ivan Ivanov",
    "email": "admin@hospital1.ru",
    "password": "securepassword"
  }
}
```

### Authentication

```http
POST /auth/login
Content-Type: application/json

{
  "email": "admin@hospital1.ru",
  "password": "securepassword"
}
```

### Getting Patients

```http
GET /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### Managing Limits

```http
PUT /limits/{tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "maxDocuments": 5000,
  "maxDataSizeKB": 102400,
  "monthlyQueries": 10000
}
```

## Implementation Features

### Advantages

1. **Complete data isolation** between tenants
2. **Scalability** - each tenant can have its own database
3. **Security** - unique encryption keys for each tenant
4. **Auditing** - complete logging of all operations
5. **Resource control** - limit system prevents abuse

### Potential Improvements

1. **Data validation** - add DTO validation
2. **Error handling** - centralized error handling system
3. **Caching** - Redis for improved performance
4. **Monitoring** - integration with monitoring systems
5. **Testing** - unit and integration test coverage

## New Features and Improvements

### âœ… Data Validation System

**Implemented full validation for all DTOs:**

#### UserDto

```typescript
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

#### CreateCompanyDto

```typescript
{
  companyName: string,  // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(100)
  user: UserDto         // @ValidateNested, @Type(() => UserDto)
}
```

#### LoginCredentialsDto

```typescript
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}
```

#### UpdateCredentialsDto

```typescript
// Inherits from LoginCredentialsDto, all fields optional
```

### âœ… Full CRUD for Patients

**New endpoints:**

```
GET /patients/:id     - Get patient by ID
PUT /patients/:id     - Update patient data
DELETE /patients/:id  - Delete patient
```

**Features:**

- ObjectId validation for security
- Check patient existence before operations
- Automatic limit updates on deletion
- Proper HTTP statuses (404 for non-existent records)

### âœ… Improved DTO Structure

**Standardized structure following Patient DTO pattern:**

- `CreateXxxDto` - for creating records (all fields required)
- `UpdateXxxDto extends PartialType(CreateXxxDto)` - for updates (all fields optional)

### âœ… Code Cleanup

**Removed all explanatory comments:**

- Russian comments - completely removed
- English explanatory comments - removed
- Commented code - removed
- Redundant comments - removed

**Result:**

- Code became cleaner and more professional
- Improved readability
- Fixed linter errors

### âœ… ValidationPipe Settings

**Global validation in main.ts:**

```typescript
app.useGlobalPipes(
  new ValidationPipe({
    whitelist: true, // Remove properties without decorators
    forbidNonWhitelisted: true, // Return error for extra properties
  })
);
```

### âœ… Error Handling

**Improved error handling:**

- `NotFoundException` instead of regular `Error`
- Proper HTTP statuses
- Clear error messages in Russian

## New API Usage Examples

### Creating a Patient

```http
POST /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "Ivan",
  "surname": "Ivanov",
  "age": 30
}
```

### Updating a Patient

```http
PUT /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "New Name",
  "age": 31
}
```

### Deleting a Patient

```http
DELETE /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### Validation Error Responses

```json
{
  "statusCode": 400,
  "message": [
    "User name is required",
    "Invalid email format",
    "Password must contain at least 6 characters"
  ],
  "error": "Bad Request"
}
```

## Conclusion

HIS is a modern multi-tenant hospital information management system with a focus on security, data isolation, and scalability. The system now includes complete data validation, CRUD operations for all entities, and professionally formatted code without redundant comments.

The architecture allows easy addition of new medical organizations without affecting existing data and ensures a high level of security through individual encryption keys and isolated databases.

---

## System Status Assessment

### Implemented Features

- **Multi-tenant architecture**: Ensures complete data isolation between organizations
- **Comprehensive validation**: System validates all incoming data against requirements
- **Limit system**: Automatic protection against resource overload
- **Full auditing**: Detailed logging of all system operations

### Development Plans

- **Caching**: Redis integration for improved performance
- **Testing**: Expand unit and integration test coverage
- **Monitoring**: Add monitoring and alerting systems
- **User Interface**: Develop web interface for system management

### System Deployment

```bash
# Main application
cd His
npm install
npm run start:dev

# Producer (if needed)
cd ../producer
npm install
npm run start:dev

# Consumer (if needed)
cd ../consumer
npm install
npm run start:dev
```

**Requirements**: MongoDB and RabbitMQ must be configured before startup.

### Troubleshooting

1. Ensure MongoDB is running and accessible
2. Check environment variable settings
3. Review application logs for error diagnosis
4. For complex issues, refer to the Issues section

### Developer Recommendations

**Adding a new module:**

1. Use the `patients/` module structure as a template
2. Replace `Patient` with your entity name
3. Add appropriate validation to DTO
4. Don't forget to integrate with limits and audit systems

**Multi-tenancy debugging:**

- Always check for `X-TENANT-ID` header in requests
- System logs show which database is being connected to
- If something doesn't work, first check if the tenant exists

**Performance optimization:**

- MongoDB indexes are configured automatically
- Set limits considering real organization needs
- Audit works asynchronously and doesn't affect main operation performance

### Support and Development

The system is developed with extensibility and modularity principles in mind. If you have questions about the code or suggestions for improvement - we're open to collaboration.

Use the project's Issues system to report bugs or suggestions.
