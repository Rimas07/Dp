# HIS (Hospital Information System) - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

## –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã HIS - –º–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–ª—å–Ω–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π. –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π: NestJS, MongoDB –∏ RabbitMQ.

–ö–ª—é—á–µ–≤–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã - –ø–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ (—Ç–µ–Ω–∞–Ω—Ç–∞–º–∏). –ö–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ, –Ω–µ –∏–º–µ—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–∏—Å—Ç–µ–º–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞—É–¥–∏—Ç, —Å–∏—Å—Ç–µ–º—É –ª–∏–º–∏—Ç–æ–≤ –∏ –Ω–∞–¥—ë–∂–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

**–î–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ MongoDB** (–ª–æ–∫–∞–ª—å–Ω–æ –∏–ª–∏ –≤ Docker)
2. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `npm install` –≤ –ø–∞–ø–∫–µ `His`
3. **–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—É—é –º–µ–¥–∏—Ü–∏–Ω—Å–∫—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é**:
   ```bash
   curl -X POST http://localhost:3000/tenants/create-company \
     -H "Content-Type: application/json" \
     -d '{"companyName":"–¢–µ—Å—Ç–æ–≤–∞—è –±–æ–ª—å–Ω–∏—Ü–∞","user":{"name":"–ê–¥–º–∏–Ω","email":"admin@test.ru","password":"123456"}}'
   ```
4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É** –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞
5. **–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞** –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã

**–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç—å –∫ –∏–∑—É—á–µ–Ω–∏—é –ø–æ–ª–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.**

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

### 1. **His** - –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–∏—Å—Ç–µ–º—ã, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –Ω–∞ –ø–æ—Ä—Ç—É 3000. –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –æ—Å–Ω–æ–≤–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –∏ API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏ –∏ –¥—Ä—É–≥–∏–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏.

–ö–∞–∂–¥–∞—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –≤ MongoDB, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏.

### 2. **Producer** - —Å–µ—Ä–≤–∏—Å –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π –≤ RabbitMQ. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–∞–∂–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∑–∞–∫–∞–∑–∞) Producer –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–æ–±—ã—Ç–∏—è –≤ –æ—á–µ—Ä–µ–¥—å.

### 3. **Consumer** - —Å–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–±—ã—Ç–∏—è –∏–∑ RabbitMQ. –í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å–Ω–æ–≤–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–µ–Ω–æ —Ä–∞–±–æ—Ç–µ —Å –∑–∞–∫–∞–∑–∞–º–∏, –æ–¥–Ω–∞–∫–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Å–æ–±—ã—Ç–∏–π.

## –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã His

### üè¢ Tenants Module (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏)

**–§–∞–π–ª—ã**: `src/tenants/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π (–∫–æ–º–ø–∞–Ω–∏–π)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ —Ç–µ–Ω–∞–Ω—Ç–æ–≤ (nanoid)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤

**API Endpoints**:

```
POST /tenants/create-company - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏
```

**–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö**:

```typescript
{
  companyName: string,  // –ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏
  tenantId: string      // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —Ç–µ–Ω–∞–Ω—ÇÔøΩÔøΩ
}
```

### üë§ Users Module (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)

**–§–∞–π–ª—ã**: `src/users/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ —Ç–µ–Ω–∞–Ω—Ç—É
- –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
- –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ email
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é DTO

**DTO (Data Transfer Objects)**:

```typescript
// UserDto
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:

- `@IsNotEmpty()` - –≤—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã
- `@IsString()` - –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
- `@IsEmail()` - –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email
- `@MinLength()` / `@MaxLength()` - –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª–∏–Ω—ã

**–°—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö**:

```typescript
{
  name: string,
  email: string,
  password: string,    // –•–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
  tenantId: string     // –ü—Ä–∏–≤—è–∑–∫–∞ –∫ —Ç–µ–Ω–∞–Ω—Ç—É
}
```

### üîê Auth Module (–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

**–§–∞–π–ª—ã**: `src/auth/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤ —Å —Ç–µ–Ω–∞–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ —Å–µ–∫—Ä–µ—Ç–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ/–¥–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤

**API Endpoints**:

```
POST /auth/login - –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
```

**–ü—Ä–æ—Ü–µ—Å—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**:

1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π
3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ªÔøΩÔøΩ —Ç–µ–Ω–∞–Ω—Ç–∞
4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞
5. –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–∫–µ–Ω–∞ –∏ tenantId

### üè• Patients Module (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞–º–∏)

**–§–∞–π–ª—ã**: `src/patients/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –ü–æ–ª–Ω—ã–π CRUD –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ (—Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ)
- –ò–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏
- –ó–∞—â–∏—Ç–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π
- –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é DTO
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ ObjectId –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**API Endpoints**:

```
GET /patients - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤ (—Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)
GET /patients/:id - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ ID
POST /patients - –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
PUT /patients/:id - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞
DELETE /patients/:id - –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
```

**DTO (Data Transfer Objects)**:

```typescript
// CreatePatientDto
{
  name: string,     // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, —Å—Ç—Ä–æ–∫–∞, 2-50 —Å–∏–º–≤–æ–ª–æ–≤
  surname: string,  // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, —Å—Ç—Ä–æ–∫–∞, 2-50 —Å–∏–º–≤–æ–ª–æ–≤
  age: number       // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ, —á–∏—Å–ª–æ, –º–∏–Ω–∏–º—É–º 0
}

// UpdatePatientDto - –Ω–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç CreatePatientDto, –≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è**:

- `@IsNotEmpty()` - –≤—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏
- `@IsString()` - name –∏ surname –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä–æ–∫–∞–º–∏
- `@IsInt()` - age –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —á–∏—Å–ª–æ–º
- `@Min(0)` - –≤–æ–∑—Ä–∞—Å—Ç –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º
- `@Type(() => Number)` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –≤ —á–∏—Å–ª–æ

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:

- MongoDB –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç `_id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ü–∏–µ–Ω—Ç–∞
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º/—É–¥–∞–ª–µ–Ω–∏–µ–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–æ–≤ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã (404 –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤)

### üìä Limits Module (–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏)

**–§–∞–π–ª—ã**: `src/limits/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è —Ç–µ–Ω–∞–Ω—Ç–æ–≤ (–¥–æ–∫—É–º–µ–Ω—Ç—ã, —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö, –∑–∞–ø—Ä–æ—Å—ã)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤

**API Endpoints**:

```
GET /limits/:tenantId - –ü–æ–ª—É—á–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ —Ç–µ–Ω–∞–Ω—Ç–∞
PUT /limits/:tenantId - –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —Ç–µ–Ω–∞–Ω—Ç–∞
GET /limits/usage/:tenantId - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
```

**–¢–∏–ø—ã –ª–∏–º–∏—Ç–æ–≤**:

- `maxDocuments` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- `maxDataSizeKB` - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö –≤ KB
- `monthlyQueries` - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–µ—Å—è—Ü

### üìù Audit Module (–ê—É–¥–∏—Ç)

**–§–∞–π–ª—ã**: `src/audit/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –∞—É–¥–∏—Ç–∞ –≤ RabbitMQ
- –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã)

**–î–∞–Ω–Ω—ã–µ –∞—É–¥–∏—Ç–∞**:

- –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
- ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ç–µ–Ω–∞–Ω—Ç–∞
- HTTP –º–µ—Ç–æ–¥ –∏ –ø—É—Ç—å
- –°—Ç–∞—Ç—É—Å –∫–æ–¥ –∏ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- IP –∞–¥—Ä–µ—Å –∏ User-Agent
- –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (—Å —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–µ–π)

### üîÑ Proxy Module (–ü—Ä–æ–∫—Å–∏)

**–§–∞–π–ª—ã**: `src/proxy/`

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:

- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- –ë–∞–∑–æ–≤—ã–π health check endpoint

**API Endpoints**:

```
GET /proxy/health - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è
```

## –ú–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ú–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å —è–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é —Å–∏—Å—Ç–µ–º—ã. –û–Ω–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–º–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏ - –∫–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –Ω–µ –∏–º–µ—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –¥—Ä—É–≥–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

### –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ò–∑–æ–ª—è—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:

   - –ö–∞–∂–¥–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö MongoDB
   - –ü—Ä–∏–º–µ—Ä: "–ë–æ–ª—å–Ω–∏—Ü–∞ –°–æ–ª–Ω—ã—à–∫–æ" ‚Üí –±–∞–∑–∞ `tenant_abc123`
   - –ü–æ–ª–Ω–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏

2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ**:

   - –§–æ—Ä–º–∞—Ç –∏–º–µ–Ω–∏ –±–∞–∑—ã: `tenant_{tenantId}`
   - –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ—Å—Ç—å –∏ —É–¥–æ–±—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è

3. **Middleware –ø—Ä–æ–≤–µ—Ä–∫–∏**:

   - –ö–∞–∂–¥—ã–π –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-TENANT-ID`
   - –ü—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º ID –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

4. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**:
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤
   - –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞ - —Å–∏—Å—Ç–µ–º–∞ —Å–∞–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω—É—é –±–∞–∑—É

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏

#### TenantMiddleware

- –ò–∑–≤–ª–µ–∫–∞–µ—Ç `tenantId` –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-TENANT-ID`
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞
- –î–æ–±–∞–≤–ª—è–µ—Ç `tenantId` –≤ –æ–±—ä–µ–∫—Ç –∑–∞–ø—Ä–æ—Å–∞

#### TenantConnectionProvider

- –°–æ–∑–¥–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö —Ç–µ–Ω–∞–Ω—Ç–æ–≤
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç request-scoped –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –±–∞–∑–∞–º–∏

#### TenantAuthenticationGuard

- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã —Å —Ç–µ–Ω–∞–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏
- –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–µ–Ω–∞–Ω—Ç–∞

## –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ

- **–ê–ª–≥–æ—Ä–∏—Ç–º**: Cryptr –¥–ª—è —Å–∏–º–º–µ—Ç—Ä–∏—á–Ω–æ–≥–æ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
- **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ**: –°–µ–∫—Ä–µ—Ç–Ω—ã–µ –∫–ª—é—á–∏ JWT —Ç–æ–∫–µ–Ω–æÔøΩÔøΩ
- **–ö–ª—é—á —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è**: –•—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### JWT —Ç–æ–∫–µ–Ω—ã

- **–£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏**: –ö–∞–∂–¥—ã–π —Ç–µ–Ω–∞–Ω—Ç –∏–º–µ–µ—Ç —Å–≤–æ–π —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á
- **–í—Ä–µ–º—è –∂–∏–∑–Ω–∏**: 10 —á–∞—Å–æ–≤
- **–°–æ–¥–µ—Ä–∂–∏–º–æ–µ**: userId –≤ payload

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

- **–ê–ª–≥–æ—Ä–∏—Ç–º**: bcrypt
- **–†–∞—É–Ω–¥—ã**: 10

## –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Producer Service

**–§—É–Ω–∫—Ü–∏–∏**:

- –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–∫–∞–∑–æ–≤ –≤ RabbitMQ
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤
- –≠–º–∏—Å—Å–∏—è —Å–æ–±—ã—Ç–∏–π `order-placed`

**API**:

```
POST /orders - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞
GET /orders - –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
```

### Consumer Service

**–§—É–Ω–∫—Ü–∏–∏**:

- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π `order-placed`
- –•—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ –ø–∞–º—è—Ç–∏
- –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–∞–∫–∞–∑–æ–≤

**–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏**:

- `handleOrderPlaced` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤
- `getOrders` - –í–æ–∑–≤—Ä–∞—Ç —Å–ø–∏—Å–∫–∞ –∑–∞–∫–∞–∑–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```
PORT=3000
DATABASE_CONNECTION_STRING=mongodb://localhost:27017/his
SECURITY_ENCRYPTION_SECRET_KEY=your-encryption-key
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–û—Å–Ω–æ–≤–Ω—ã–µ**:

- NestJS (—Ñ—Ä–µ–π–º–≤–æ—Ä–∫)
- Mongoose (MongoDB ODM)
- JWT (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- bcrypt (—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
- nanoid (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è ID)
- cryptr (—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ)
- RabbitMQ (—Å–æ–æ–±—â–µ–Ω–∏—è)

### –ó–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã

```bash
# –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
cd His
npm run start:dev

# Producer
cd producer
npm run start:dev

# Consumer
cd consumer
npm run start:dev
```

## API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏

```http
POST /tenants/create-company
Content-Type: application/json

{
  "companyName": "–ì–æ—Ä–æ–¥—Å–∫–∞—è –±–æ–ª—å–Ω–∏—Ü–∞ ‚Ññ1",
  "user": {
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "email": "admin@hospital1.ru",
    "password": "securepassword"
  }
}
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

```http
POST /auth/login
Content-Type: application/json

{
  "email": "admin@hospital1.ru",
  "password": "securepassword"
}
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

```http
GET /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞–º–∏

```http
PUT /limits/{tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "maxDocuments": 5000,
  "maxDataSizeKB": 102400,
  "monthlyQueries": 10000
}
```

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **–ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö** –º–µ–∂–¥—É —Ç–µ–Ω–∞–Ω—Ç–∞–º–∏
2. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –∫–∞–∂–¥—ã–π —Ç–µ–Ω–∞–Ω—Ç –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Å–≤–æ—é –±–∞–∑—É
3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–µ–Ω–∞–Ω—Ç–∞
4. **–ê—É–¥–∏—Ç** - –ø–æ–ª–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. **–ö–æ–Ω—Ç—Ä–æ–ª—å —Ä–µ—Å—É—Ä—Å–æ–≤** - —Å–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏—è

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
3. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - Redis –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
5. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–∫—Ä—ã—Ç–∏–µ unit –∏ integration —Ç–µ—Å—Ç–∞–º–∏

## –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —É–ª—É—á—à–µ–Ω–∏—è

### ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö DTO:**

#### UserDto

```typescript
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

#### CreateCompanyDto

```typescript
{
  companyName: string,  // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(100)
  user: UserDto         // @ValidateNested, @Type(() => UserDto)
}
```

#### LoginCredentialsDto

```typescript
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}
```

#### UpdateCredentialsDto

```typescript
// –ù–∞—Å–ª–µ–¥—É–µ—Ç –æ—Ç LoginCredentialsDto, –≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã
```

### ‚úÖ –ü–æ–ª–Ω—ã–π CRUD –¥–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–æ–≤

**–ù–æ–≤—ã–µ endpoints:**

```
GET /patients/:id     - –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–æ ID
PUT /patients/:id     - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ü–∏–µ–Ω—Ç–∞
DELETE /patients/:id  - –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞
```

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**

- –í–∞–ª–∏–¥–∞—Ü–∏—è ObjectId –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–∞—Ü–∏–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã (404 –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–ø–∏—Å–µ–π)

### ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ DTO

**–°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ —Ç–∏–ø—É Patient DTO:**

- `CreateXxxDto` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–µ–π (–≤—Å–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã)
- `UpdateXxxDto extends PartialType(CreateXxxDto)` - –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤—Å–µ –ø–æ–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã)

### ‚úÖ –û—á–∏—Å—Ç–∫–∞ –∫–æ–¥–∞

**–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –æ–±—ä—è—Å–Ω—è—é—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**

- –†—É—Å—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω—ã
- –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –æ–±—ä—è—Å–Ω—è—é—â–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - —É–¥–∞–ª–µ–Ω—ã
- –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ - —É–¥–∞–ª–µ–Ω
- –ò–∑–±—ã—Ç–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ - —É–¥–∞–ª–µ–Ω—ã

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**

- –ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–µ–µ
- –£–ª—É—á—à–µ–Ω–∞ —á–∏—Ç–∞–µ–º–æ—Å—Ç—å
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞

### ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ValidationPipe

**–ì–ª–æ–±–∞–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤ main.ts:**

```typescript
app.useGlobalPipes(
  new ValidationPipe({
    whitelist: true, // –£–¥–∞–ª—è–µ—Ç —Å–≤–æ–π—Å—Ç–≤–∞ –±–µ–∑ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤
    forbidNonWhitelisted: true, // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ –ª–∏—à–Ω–∏—Ö —Å–≤–æ–π—Å—Ç–≤–∞—Ö
  })
);
```

### ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**

- `NotFoundException` –≤–º–µ—Å—Ç–æ –æ–±—ã—á–Ω–æ–≥–æ `Error`
- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã
- –ü–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö API

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞

```http
POST /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "–ò–≤–∞–Ω",
  "surname": "–ò–≤–∞–Ω–æ–≤",
  "age": 30
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞

```http
PUT /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "–ù–æ–≤–æ–µ –∏–º—è",
  "age": 31
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –ø–∞—Ü–∏–µ–Ω—Ç–∞

```http
DELETE /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### –û—Ç–≤–µ—Ç—ã –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```json
{
  "statusCode": 400,
  "message": [
    "–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ",
    "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email",
    "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 6 —Å–∏–º–≤–æ–ª–æ–≤"
  ],
  "error": "Bad Request"
}
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

HIS –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—É—é –º–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω—É—é —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–æ–ª—å–Ω–∏—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å. –°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç –ø–æ–ª–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö, CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–π –∫–æ–¥ –±–µ–∑ –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

---

## –û—Ü–µ–Ω–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ú–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—É—é –∏–∑–æ–ª—è—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º–∏
- **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º
- **–°–∏—Å—Ç–µ–º–∞ –ª–∏–º–∏—Ç–æ–≤**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
- **–ü–æ–ª–Ω—ã–π –∞—É–¥–∏—Ç**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ —Å–∏—Å—Ç–µ–º–µ

### –ü–ª–∞–Ω—ã –ø–æ —Ä–∞–∑–≤–∏—Ç–∏—é

- **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Redis –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ø–æ–∫—Ä—ã—Ç–∏—è unit –∏ integration —Ç–µ—Å—Ç–∞–º–∏
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞
- **–ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö**: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π

### –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

```bash
# –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
cd His
npm install
npm run start:dev

# Producer (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
cd ../producer
npm install
npm run start:dev

# Consumer (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏)
cd ../consumer
npm install
npm run start:dev
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è**: –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å MongoDB –∏ RabbitMQ.

### –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ MongoDB –∑–∞–ø—É—â–µ–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –æ—à–∏–±–æ–∫
4. –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ —Å–ª–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑–¥–µ–ª—É Issues

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è:**

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –º–æ–¥—É–ª—è `patients/` –∫–∞–∫ —à–∞–±–ª–æ–Ω
2. –ó–∞–º–µ–Ω–∏—Ç–µ `Patient` –Ω–∞ –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∞—à–µ–π —Å—É—â–Ω–æ—Å—Ç–∏
3. –î–æ–±–∞–≤—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤ DTO
4. –ù–µ –∑–∞–±—É–¥—å—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–∏–º–∏—Ç–æ–≤ –∏ –∞—É–¥–∏—Ç–∞

**–û—Ç–ª–∞–¥–∫–∞ –º–Ω–æ–≥–æ—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç–∏:**

- –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-TENANT-ID` –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö
- –õ–æ–≥–∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫ –∫–∞–∫–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- –ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –æ—à–∏–±–æ–∫ –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–µ–Ω–∞–Ω—Ç–∞

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

- MongoDB –∏–Ω–¥–µ–∫—Å—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ª–∏–º–∏—Ç—ã —Å —É—á—ë—Ç–æ–º —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–µ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
- –ê—É–¥–∏—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –∏ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–∞ —Å —É—á—ë—Ç–æ–º –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç–∏ –∏ –º–æ–¥—É–ª—å–Ω–æ—Å—Ç–∏. –ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–æ–¥—É –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é - –º—ã –æ—Ç–∫—Ä—ã—Ç—ã –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏—á–µ—Å—Ç–≤–∞.

–î–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É Issues –ø—Ä–æ–µ–∫—Ç–∞.

---

# HIS (Hospital Information System) - Project Documentation

## About the Project

This is documentation for the HIS system - a multi-tenant platform for hospital information management. The system is developed using modern technology stack: NestJS, MongoDB, and RabbitMQ.

The key feature of the system is complete data isolation between different medical organizations (tenants). Each organization operates in an isolated environment without access to other organizations' data. Additionally, the system includes built-in auditing, resource limits, and robust authentication.

## Quick Start

**To get started, follow these steps:**

1. **Start MongoDB** (locally or in Docker)
2. **Clone the repository** and run `npm install` in the `His` folder
3. **Create your first medical organization**:
   ```bash
   curl -X POST http://localhost:3000/tenants/create-company \
     -H "Content-Type: application/json" \
     -d '{"companyName":"Test Hospital","user":{"name":"Admin","email":"admin@test.ru","password":"123456"}}'
   ```
4. **Log into the system** to get a token
5. **Create your first patient** and verify the system works

**After successful startup, you can proceed to study the full documentation.**

## System Architecture

The system consists of three main components:

### 1. **His** - Main Application

The central component of the system, running on port 3000. Contains all core business logic and APIs for working with patients, users, tenants, and other entities.

Each medical organization gets a separate MongoDB database, ensuring complete data isolation between organizations.

### 2. **Producer** - Message Sending Service

Responsible for sending messages to RabbitMQ. When important events occur (e.g., creating a new order), Producer sends corresponding events to the queue.

### 3. **Consumer** - Message Processing Service

Processes incoming events from RabbitMQ. The current implementation focuses mainly on order handling, but the architecture allows easy addition of other event types.

## Core System Modules

### üè¢ Tenants Module - New Hospital Registration

**Location**: `src/tenants/`

When a new hospital wants to join our system, it goes through this module. We:

- Create a unique ID for the hospital (using nanoid - very reliable)
- Automatically create an administrator for this hospital
- Generate a secret key for JWT tokens
- Set up default limits

**How to use**:

```bash
POST /tenants/create-company
```

Just send the hospital name and administrator data, and we'll set everything up automatically.

**What to send**:

```typescript
{
  companyName: "City Hospital #1",  // Hospital name
  user: {
    name: "Ivan Petrov",
    email: "admin@hospital1.ru",
    password: "securepassword123"
  }
}
```

### üë§ Users Module - User Management

**Location**: `src/users/`

**Functionality**:

- Create users with tenant binding
- Password hashing (bcrypt)
- Find users by email
- Data validation with DTO

**DTO (Data Transfer Objects)**:

```typescript
// UserDto
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

**Validation**:

- `@IsNotEmpty()` - all fields are required
- `@IsString()` - fields must be strings
- `@IsEmail()` - correct email format
- `@MinLength()` / `@MaxLength()` - length constraints

**Data Schema**:

```typescript
{
  name: string,
  email: string,
  password: string,    // Hashed password
  tenantId: string     // Tenant binding
}
```

### üîê Auth Module - Authentication

**Location**: `src/auth/`

**Functionality**:

- User authentication
- JWT token generation with tenant-specific secret keys
- Secret key encryption/decryption
- Secret key creation for new tenants
- Login data validation

**API Endpoints**:

```
POST /auth/login - System login
```

**DTO (Data Transfer Objects)**:

```typescript
// LoginCredentialsDto
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}

// UpdateCredentialsDto extends PartialType(LoginCredentialsDto)
```

**Authentication Process**:

1. Input data validation
2. Check if user exists
3. Compare passwords
4. Get secret key for tenant
5. Generate JWT token
6. Return token and tenantId

### üè• Patients Module - Patient Management

**Location**: `src/patients/`

**Functionality**:

- Full CRUD for patients (create, read, update, delete)
- Data isolation between tenants
- Authorization protection
- Data validation with DTO
- Automatic limit management
- ObjectId validation for security

**API Endpoints**:

```
GET /patients - Get list of patients (requires authentication)
GET /patients/:id - Get patient by ID
POST /patients - Create new patient
PUT /patients/:id - Update patient data
DELETE /patients/:id - Delete patient
```

**DTO (Data Transfer Objects)**:

```typescript
// CreatePatientDto
{
  name: string,     // Required, string, 2-50 characters
  surname: string,  // Required, string, 2-50 characters
  age: number       // Required, number, minimum 0
}

// UpdatePatientDto - inherits from CreatePatientDto, all fields optional
```

**Validation**:

- `@IsNotEmpty()` - all fields required for creation
- `@IsString()` - name and surname must be strings
- `@IsInt()` - age must be a number
- `@Min(0)` - age cannot be negative
- `@Type(() => Number)` - automatic string to number conversion

**Features**:

- MongoDB automatically generates `_id` for each patient
- Check patient existence before update/delete operations
- Automatic limit counter updates on creation/deletion
- Proper HTTP statuses (404 for non-existent patients)

### üìä Limits Module - Limit Management

**Location**: `src/limits/`

**Functionality**:

- Set limits for tenants (documents, data size, queries)
- Monitor resource usage
- Block on limit exceedance

**API Endpoints**:

```
GET /limits/:tenantId - Get tenant limits
PUT /limits/:tenantId - Set tenant limits
GET /limits/usage/:tenantId - Usage statistics
```

**Limit Types**:

- `maxDocuments` - Maximum number of documents
- `maxDataSizeKB` - Maximum data size in KB
- `monthlyQueries` - Number of queries per month

### üìù Audit Module - Auditing

**Location**: `src/audit/`

**Functionality**:

- Log all HTTP requests
- Send audit events to RabbitMQ
- Sanitize sensitive data (passwords, tokens)

**Audit Data**:

- Timestamp
- User and tenant ID
- HTTP method and path
- Status code and execution time
- IP address and User-Agent
- Request body (with sanitization)

### üîÑ Proxy Module - Proxy

**Location**: `src/proxy/`

**Functionality**:

- System status check
- Basic health check endpoint

**API Endpoints**:

```
GET /proxy/health - Status check
```

## Multi-Tenant Architecture

Multi-tenancy is a key feature of the system. It ensures complete data isolation between different medical organizations - each organization operates independently without access to other organizations' data.

### How It Works

1. **Database-level isolation**:

   - Each organization gets a separate MongoDB database
   - Example: "Sunshine Hospital" ‚Üí database `tenant_abc123`
   - Complete data separation between organizations

2. **Standardized naming**:

   - Database name format: `tenant_{tenantId}`
   - Ensures predictability and ease of administration

3. **Middleware validation**:

   - Each incoming request checks the `X-TENANT-ID` header
   - Access is blocked for invalid ID or non-existent organization

4. **Dynamic connection**:
   - Automatic switching between tenant databases
   - Transparency for developer - system determines the required database

### Multi-Tenancy Components

#### TenantMiddleware

- Extracts `tenantId` from `X-TENANT-ID` header
- Checks tenant existence
- Adds `tenantId` to request object

#### TenantConnectionProvider

- Creates connections to tenant databases
- Uses request-scoped providers
- Automatically switches between databases

#### TenantAuthenticationGuard

- Validates JWT tokens with tenant-specific keys
- Ensures tenant-level security

## Security System

### Encryption

- **Algorithm**: Cryptr for symmetric encryption
- **Application**: JWT token secret keys
- **Encryption key**: Stored in environment variables

### JWT Tokens

- **Unique keys**: Each tenant has its own secret key
- **Lifetime**: 10 hours
- **Content**: userId in payload

### Password Hashing

- **Algorithm**: bcrypt
- **Rounds**: 10

## Microservice Architecture

### Producer Service

**Functions**:

- Send orders to RabbitMQ
- Get list of orders
- Emit `order-placed` events

**API**:

```
POST /orders - Create order
GET /orders - Get orders
```

### Consumer Service

**Functions**:

- Process `order-placed` events
- Store orders in memory
- Provide API for getting orders

**Handlers**:

- `handleOrderPlaced` - Process new orders
- `getOrders` - Return order list

## Configuration and Deployment

### Environment Variables (.env)

```
PORT=3000
DATABASE_CONNECTION_STRING=mongodb://localhost:27017/his
SECURITY_ENCRYPTION_SECRET_KEY=your-encryption-key
```

### Dependencies

**Core**:

- NestJS (framework)
- Mongoose (MongoDB ODM)
- JWT (authentication)
- bcrypt (hashing)
- nanoid (ID generation)
- cryptr (encryption)
- RabbitMQ (messaging)

### System Startup

```bash
# Main application
cd His
npm run start:dev

# Producer (if needed)
cd producer
npm run start:dev

# Consumer (if needed)
cd consumer
npm run start:dev
```

## API Documentation

### Creating a Company

```http
POST /tenants/create-company
Content-Type: application/json

{
  "companyName": "City Hospital #1",
  "user": {
    "name": "Ivan Ivanov",
    "email": "admin@hospital1.ru",
    "password": "securepassword"
  }
}
```

### Authentication

```http
POST /auth/login
Content-Type: application/json

{
  "email": "admin@hospital1.ru",
  "password": "securepassword"
}
```

### Getting Patients

```http
GET /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### Managing Limits

```http
PUT /limits/{tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "maxDocuments": 5000,
  "maxDataSizeKB": 102400,
  "monthlyQueries": 10000
}
```

## Implementation Features

### Advantages

1. **Complete data isolation** between tenants
2. **Scalability** - each tenant can have its own database
3. **Security** - unique encryption keys for each tenant
4. **Auditing** - complete logging of all operations
5. **Resource control** - limit system prevents abuse

### Potential Improvements

1. **Data validation** - add DTO validation
2. **Error handling** - centralized error handling system
3. **Caching** - Redis for improved performance
4. **Monitoring** - integration with monitoring systems
5. **Testing** - unit and integration test coverage

## New Features and Improvements

### ‚úÖ Data Validation System

**Implemented full validation for all DTOs:**

#### UserDto

```typescript
{
  name: string,     // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(50)
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(6), @MaxLength(100)
}
```

#### CreateCompanyDto

```typescript
{
  companyName: string,  // @IsNotEmpty, @IsString, @MinLength(2), @MaxLength(100)
  user: UserDto         // @ValidateNested, @Type(() => UserDto)
}
```

#### LoginCredentialsDto

```typescript
{
  email: string,    // @IsNotEmpty, @IsEmail
  password: string  // @IsNotEmpty, @IsString, @MinLength(1)
}
```

#### UpdateCredentialsDto

```typescript
// Inherits from LoginCredentialsDto, all fields optional
```

### ‚úÖ Full CRUD for Patients

**New endpoints:**

```
GET /patients/:id     - Get patient by ID
PUT /patients/:id     - Update patient data
DELETE /patients/:id  - Delete patient
```

**Features:**

- ObjectId validation for security
- Check patient existence before operations
- Automatic limit updates on deletion
- Proper HTTP statuses (404 for non-existent records)

### ‚úÖ Improved DTO Structure

**Standardized structure following Patient DTO pattern:**

- `CreateXxxDto` - for creating records (all fields required)
- `UpdateXxxDto extends PartialType(CreateXxxDto)` - for updates (all fields optional)

### ‚úÖ Code Cleanup

**Removed all explanatory comments:**

- Russian comments - completely removed
- English explanatory comments - removed
- Commented code - removed
- Redundant comments - removed

**Result:**

- Code became cleaner and more professional
- Improved readability
- Fixed linter errors

### ‚úÖ ValidationPipe Settings

**Global validation in main.ts:**

```typescript
app.useGlobalPipes(
  new ValidationPipe({
    whitelist: true, // Remove properties without decorators
    forbidNonWhitelisted: true, // Return error for extra properties
  })
);
```

### ‚úÖ Error Handling

**Improved error handling:**

- `NotFoundException` instead of regular `Error`
- Proper HTTP statuses
- Clear error messages in Russian

## New API Usage Examples

### Creating a Patient

```http
POST /patients
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "Ivan",
  "surname": "Ivanov",
  "age": 30
}
```

### Updating a Patient

```http
PUT /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
Content-Type: application/json

{
  "name": "New Name",
  "age": 31
}
```

### Deleting a Patient

```http
DELETE /patients/{patientId}
X-TENANT-ID: {tenantId}
Authorization: Bearer {jwt-token}
```

### Validation Error Responses

```json
{
  "statusCode": 400,
  "message": [
    "User name is required",
    "Invalid email format",
    "Password must contain at least 6 characters"
  ],
  "error": "Bad Request"
}
```

## Conclusion

HIS is a modern multi-tenant hospital information management system with a focus on security, data isolation, and scalability. The system now includes complete data validation, CRUD operations for all entities, and professionally formatted code without redundant comments.

The architecture allows easy addition of new medical organizations without affecting existing data and ensures a high level of security through individual encryption keys and isolated databases.

---

## System Status Assessment

### Implemented Features

- **Multi-tenant architecture**: Ensures complete data isolation between organizations
- **Comprehensive validation**: System validates all incoming data against requirements
- **Limit system**: Automatic protection against resource overload
- **Full auditing**: Detailed logging of all system operations

### Development Plans

- **Caching**: Redis integration for improved performance
- **Testing**: Expand unit and integration test coverage
- **Monitoring**: Add monitoring and alerting systems
- **User Interface**: Develop web interface for system management

### System Deployment

```bash
# Main application
cd His
npm install
npm run start:dev

# Producer (if needed)
cd ../producer
npm install
npm run start:dev

# Consumer (if needed)
cd ../consumer
npm install
npm run start:dev
```

**Requirements**: MongoDB and RabbitMQ must be configured before startup.

### Troubleshooting

1. Ensure MongoDB is running and accessible
2. Check environment variable settings
3. Review application logs for error diagnosis
4. For complex issues, refer to the Issues section

### Developer Recommendations

**Adding a new module:**

1. Use the `patients/` module structure as a template
2. Replace `Patient` with your entity name
3. Add appropriate validation to DTO
4. Don't forget to integrate with limits and audit systems

**Multi-tenancy debugging:**

- Always check for `X-TENANT-ID` header in requests
- System logs show which database is being connected to
- If something doesn't work, first check if the tenant exists

**Performance optimization:**

- MongoDB indexes are configured automatically
- Set limits considering real organization needs
- Audit works asynchronously and doesn't affect main operation performance

### Support and Development

The system is developed with extensibility and modularity principles in mind. If you have questions about the code or suggestions for improvement - we're open to collaboration.

Use the project's Issues system to report bugs or suggestions.
